import{_ as R,r as f,m as P,w as Z,a5 as K,h as H,b as s,d as t,a as l,f as W,e as n,i as V,o as Y,s as J,j as g,t as b,l as u}from"./index-D8k0Z2VW.js";import{Q as X}from"./QTd-Dz2_L_T4.js";import{a as ee}from"./apiClient-Vvvjylwf.js";import{u as ae}from"./useNotifications-C15CMF32.js";import{u as te}from"./useEntityManager-6kUzRwOq.js";import{B as oe}from"./BackButton-OAicZK4q.js";import{B as _}from"./Button-ByZOtwGJ.js";import{_ as se}from"./ButtonTableOptions-ivpzFDPv.js";import{T as re}from"./Table-DrGgNztj.js";import{M as k}from"./Modal-CwwUMTwV.js";import{P as le}from"./PageHeader-BZtJRD6F.js";import"./QTooltip-BIz5X8HU.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./QList-D6hH9GPe.js";import"./QSelect-CCFBgF8v.js";import"./QItemLabel-BiKvV_tR.js";import"./format-DyQxkAtJ.js";import"./QLinearProgress-C9Sex94R.js";const ie={class:"q-pa-md"},ne={class:"full-width row"},de={class:"col-12"},ce={class:"container"},ue={class:"filters-wrapper flex items-center justify-between q-my-lg"},me={class:"filters-left flex items-center bg-white"},pe={class:"filter-item search"},ve={class:"q-pa-md flex flex-center column text-grey full-width"},fe={class:"text-subtitle2 q-mt-sm"},ge={class:"modal-header"},be={class:"text-h6 flex items-center"},_e={class:"q-pa-md"},he={class:"text-h6 q-mb-md"},we={class:"row justify-end q-gutter-sm full-width"},xe={class:"modal-header"},Be={class:"text-h6 flex items-center"},Ce={class:"q-pa-md text-center"},ye={class:"text-h6 q-mb-md"},qe={class:"confirmation-text text-body1"},De={class:"row justify-end q-gutter-sm full-width"},Ee={__name:"Templates",setup(Pe){const{error:h,success:L}=ae(),T=a=>!!a||"Este campo es requerido",B=()=>({_id:"",name:"",value:"",label:"",description:""}),z=(a,e)=>{const o={...e};return o.category="LOGBOOK",o},j=a=>{const e=a?.data||[];return{data:e,total:e.length}},{loading:w,loadingTable:N,rows:d,formData:r,filtersData:i,fetchEntities:O}=te({entityName:"parámetro",entityNamePlural:"parámetros",getDefaultFormData:B,endpoints:{list:"/parameters/filterParameters",update:a=>`/parameters/updateParameter/${a}`},messages:{listError:"Error al cargar parámetros",updateSuccess:"Parámetro actualizado exitosamente",updateError:"Error al actualizar parámetro"},buildFilterParams:z,processResponse:j}),c=f(null),m=f(!1),p=f(!1),v=f([]);let x=null;const F=[{name:"name",align:"center",label:"Actividad",field:"name",sortable:!0},{name:"value",align:"center",label:"Cantidad",field:"value",sortable:!0},{name:"label",align:"center",label:"Tipo de actividad",field:"label",sortable:!0},{name:"description",align:"center",label:"Descripción",field:"description",sortable:!0},{name:"options",align:"center",label:"Opciones",field:"options"}],C=P(()=>r.value.value&&r.value.value>0),Q=P(()=>d.value.slice().sort((a,e)=>{const o=(a.name||"").toLowerCase(),E=(e.name||"").toLowerCase();return o.localeCompare(E,"es")})),S=a=>{const e=a.charCode||a.keyCode,o=String.fromCharCode(e);if(e!==32){if(e>=48&&e<=57){a.preventDefault();return}/^[a-zA-ZñÑáéíóúÁÉÍÓÚüÜ]$/.test(o)||a.preventDefault()}},A=a=>{a.preventDefault();const e=a.clipboardData.getData("text");i.value.search=e.replace(/[^a-zA-ZñÑáéíóúÁÉÍÓÚüÜ\s]/g,"")},$=()=>{if(x&&clearTimeout(x),!i.value.search?.trim()){d.value=[...v.value];return}x=setTimeout(()=>G(),300)},G=()=>{const a=i.value.search?.toString().trim().toLowerCase();if(!a){d.value=[...v.value];return}d.value=v.value.filter(e=>(e.name||"").toLowerCase().startsWith(a))};Z(()=>i.value.search,a=>{if(a){const e=a.replace(/[^a-zA-ZñÑáéíóúÁÉÍÓÚüÜ\s]/g,"");e!==a&&(i.value.search=e)}});const M=a=>{c.value=a,r.value._id=a._id,r.value.name=a.name,r.value.value=a.value||"",r.value.label=a.label||"",r.value.description=a.description||"",m.value=!0},y=()=>{m.value=!1,c.value=null,r.value=B()},U=()=>{if(C.value){p.value=!0;return}h("Por favor ingresa un valor válido")},q=()=>{p.value=!1},I=async()=>{if(!c.value||!r.value.value){h("Por favor verifica los datos");return}w.value=!0;try{await ee(`/parameters/updateParameter/${r.value._id}`,{value:Number(r.value.value)}),L("Parámetro actualizado exitosamente"),q(),y(),await D()}catch(a){const e=a?.response?.data?.message||a?.response?.data?.msg||a?.message||"Error al actualizar parámetro";h(e)}finally{w.value=!1}},D=async()=>{await O(),v.value=[...d.value]};return K(async()=>{await D()}),(a,e)=>(Y(),H("div",ie,[s(oe),t("div",ne,[t("div",de,[s(W,{class:"shadow-1 hero-card q-mb-xl"},{default:l(()=>[s(J,{class:"flex flex-center"},{default:l(()=>[s(le,{title:"Configuración de Bitácoras y Seguimientos",description:"Define la cantidad de bitácoras y seguimientos obligatorios por nivel operativo",align:"center"})]),_:1})]),_:1})])]),t("div",ce,[t("div",ue,[t("div",me,[t("div",pe,[s(V,{modelValue:n(i).search,"onUpdate:modelValue":[e[0]||(e[0]=o=>n(i).search=o),$],outlined:"",dense:"",clearable:"",placeholder:"Buscar por nombre...",onKeypress:S,onPaste:A},{prepend:l(()=>[s(g,{name:"search",color:"green-8"})]),_:1},8,["modelValue"])])])]),s(re,{rows:Q.value,columns:F,"row-key":"_id",loading:n(N)},{"body-cell-options":l(o=>[s(X,{props:o,class:"text-center"},{default:l(()=>[s(se,{icon:"edit",color:"grey-7",tooltip:"Editar",onClick:E=>M(o.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":l(()=>[t("div",ve,[s(g,{name:"settings",size:"2.5em",color:"primary"}),t("div",fe,b(n(i).search?"No se encontraron parámetros con ese nombre":"No hay parámetros registrados"),1)])]),_:1},8,["rows","loading"])]),s(k,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o),variant:"edit",width:"600px","max-width":"95vw",persistent:""},{header:l(()=>[t("div",ge,[t("div",be,[s(g,{name:"edit",class:"q-mr-sm"}),e[4]||(e[4]=u(" Editar Cantidad de Bitácoras ",-1))])])]),body:l(()=>[t("div",_e,[t("div",he,b(c.value?.name||"-"),1),s(V,{modelValue:n(r).value,"onUpdate:modelValue":e[1]||(e[1]=o=>n(r).value=o),outlined:"",dense:"",label:"Cantidad de Bitácoras",type:"number",rules:[T,o=>o>0||"La cantidad de bitácoras debe ser mayor que 0"]},null,8,["modelValue","rules"])])]),footer:l(()=>[t("div",we,[s(_,{label:"Cancelar","custom-class":"boton-cerrar",onClick:y}),s(_,{label:"Guardar","custom-class":"gradient-btn",onClick:U,disable:!C.value},null,8,["disable"])])]),_:1},8,["modelValue"]),s(k,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),width:"500px","max-width":"90vw",persistent:""},{header:l(()=>[t("div",xe,[t("div",Be,[s(g,{name:"help",class:"q-mr-sm"}),e[5]||(e[5]=u(" Confirmar Cambios ",-1))])])]),body:l(()=>[t("div",Ce,[t("div",ye,[e[6]||(e[6]=u(" ¿Está seguro de que desea guardar los cambios para ",-1)),t("strong",null,b(c.value?.name),1),e[7]||(e[7]=u("? ",-1))]),t("p",qe,[e[8]||(e[8]=u(" El nuevo valor será: ",-1)),t("strong",null,b(n(r).value),1)])])]),footer:l(()=>[t("div",De,[s(_,{label:"Cancelar","custom-class":"boton-cerrar",onClick:q}),s(_,{label:"Guardar","custom-class":"gradient-btn",onClick:I,loading:n(w)},null,8,["loading"])])]),_:1},8,["modelValue"])]))}},Ke=R(Ee,[["__scopeId","data-v-b2e4c833"]]);export{Ke as default};
