import{_ as F,r as g,a5 as k,h as G,b as r,d as a,a as u,f as E,o as J,s as b,i as c,e as q,l as $,j as X}from"./index-D8k0Z2VW.js";import{a as j}from"./apiClient-Vvvjylwf.js";import{u as B}from"./useNotifications-C15CMF32.js";import{u as Z}from"./useEntityManager-6kUzRwOq.js";import{B as Q}from"./BackButton-OAicZK4q.js";import{B as R}from"./Button-ByZOtwGJ.js";import{M as Y}from"./Modal-CwwUMTwV.js";import{P as z}from"./PageHeader-BZtJRD6F.js";const K={class:"q-pa-md"},W={class:"full-width row"},ee={class:"col-12"},ae={class:"container"},se={class:"config-row"},te={class:"config-input-group"},le={class:"config-row"},oe={class:"config-input-group"},re={class:"config-row"},ie={class:"config-input-group"},ne={class:"config-row"},ue={class:"config-input-group"},de={class:"form-actions"},ce={class:"alert-box alert-yellow q-mb-md"},me={class:"alert-content"},Ae={class:"alert-input-group"},ve={class:"alert-box alert-orange q-mb-md"},pe={class:"alert-content"},ge={class:"alert-input-group"},Re={class:"alert-box alert-red q-mb-md"},fe={class:"alert-content"},Ee={class:"alert-input-group"},be={class:"form-actions"},_e={class:"modal-header"},Ie={class:"text-h6 flex items-center"},Se={class:"q-pa-md text-center"},Te=["innerHTML"],Ce={class:"row justify-end q-gutter-sm full-width"},Ne={__name:"Alerts",setup(ye){const L=()=>({_id:"",name:"",value:0,description:"",category:"SYSTEM"}),_={list:"/parameters/filterParameters",update:t=>`/parameters/updateParameter/${t}`},D={listError:"Error al cargar los parámetros de alerta.",noData:"No hay parámetros registrados"},h=t=>{const e=t?.data?.data||t?.data?.parameters||t?.data||[];return{data:e,total:e.length}},{loading:f,rows:O,filtersData:I,fetchEntities:M}=Z({entityName:"parameter",entityNamePlural:"parameters",getDefaultFormData:L,endpoints:_,messages:D,processResponse:h}),{error:S,success:V,warning:w}=B(),o={ALERTAS_FICHAS_NUEVAS:"ALERTAS FICHAS NUEVAS",EXPIRACION_FICHAS_ANTIGUAS:"EXPIRACION FICHAS ANTIGUAS",ALERTA_AMARILLA:"ALERTA AMARILLA",ALERTA_NARANJA:"ALERTA NARANJA",ALERTA_ROJA_CRITICA:"ALERTA ROJA CRITICA",HORAS_MENSUALES_INSTRUCTORES:"HORAS MENSUALES INSTRUCTORES",MAXIMO_REGISTROS_POR_APRENDIZ:"MAXIMO DE REGISTROS POR APRENDIZ/FICHA"},m={FICHE:"fiche",ESCALATED:"escalated"},v=g(!1),A=g(""),T=g({}),l=g({newRecordsTime:null,oldRecordsTime:null,maxRecordsPerApprentice:null,monthlyInstructorHours:null,yellowAlertDays:null,orangeAlertDays:null,redAlertDays:null});I.value.category="SYSTEM";const C=async()=>{I.value.category="SYSTEM",await M();const t=O.value;if(!t.length){w("No se encontraron parámetros de alertas en el sistema.");return}t.forEach(e=>{if(!(!e?.name||!e?._id))switch(T.value[e.name]=e._id,e.name){case o.ALERTAS_FICHAS_NUEVAS:l.value.newRecordsTime=e.value;break;case o.EXPIRACION_FICHAS_ANTIGUAS:l.value.oldRecordsTime=e.value;break;case o.MAXIMO_REGISTROS_POR_APRENDIZ:l.value.maxRecordsPerApprentice=e.value;break;case o.HORAS_MENSUALES_INSTRUCTORES:l.value.monthlyInstructorHours=e.value;break;case o.ALERTA_AMARILLA:l.value.yellowAlertDays=e.value;break;case o.ALERTA_NARANJA:l.value.orangeAlertDays=e.value;break;case o.ALERTA_ROJA_CRITICA:l.value.redAlertDays=e.value;break}})},N=t=>{A.value=t,v.value=!0},y=()=>{v.value=!1},H=()=>A.value===m.FICHE?"¿Desea guardar la configuración de <strong>FICHAS</strong>?":A.value===m.ESCALATED?"¿Desea guardar la configuración de <strong>ALERTAS ESCALADAS</strong>?":"",P=t=>{const e=[];for(const[s,p]of Object.entries(t)){const d=p.value,i=x(s);if(d==null||d===""){e.push(`${i} es obligatorio`);continue}const n=Number(d);isNaN(n)?e.push(`${i} debe ser un número válido`):n<0?e.push(`${i} no puede ser negativo`):n===0&&e.push(`${i} debe ser mayor a 0`),s===o.ALERTA_AMARILLA&&n<=15&&e.push(`${i} debe ser mayor a 15 días`),s===o.ALERTA_NARANJA&&n<=7&&e.push(`${i} debe ser mayor a 7 días`),s===o.ALERTA_NARANJA&&n>15&&e.push(`${i} debe ser menor o igual a 15 días`),s===o.ALERTA_ROJA_CRITICA&&n>7&&e.push(`${i} debe ser menor o igual a 7 días`)}return e},x=t=>{switch(t){case o.ALERTAS_FICHAS_NUEVAS:return"El tiempo límite para fichas nuevas";case o.EXPIRACION_FICHAS_ANTIGUAS:return"El tiempo límite para fichas antiguas";case o.MAXIMO_REGISTROS_POR_APRENDIZ:return"El máximo de registros por aprendiz";case o.HORAS_MENSUALES_INSTRUCTORES:return"Las horas mensuales de instructores";case o.ALERTA_AMARILLA:return"Los días para alerta amarilla";case o.ALERTA_NARANJA:return"Los días para alerta naranja";case o.ALERTA_ROJA_CRITICA:return"Los días para alerta roja";default:return"El valor"}},U=async()=>{f.value=!0;try{const t={};A.value===m.FICHE?(t[o.ALERTAS_FICHAS_NUEVAS]={value:l.value.newRecordsTime},t[o.EXPIRACION_FICHAS_ANTIGUAS]={value:l.value.oldRecordsTime},t[o.MAXIMO_REGISTROS_POR_APRENDIZ]={value:l.value.maxRecordsPerApprentice},t[o.HORAS_MENSUALES_INSTRUCTORES]={value:l.value.monthlyInstructorHours}):A.value===m.ESCALATED&&(t[o.ALERTA_AMARILLA]={value:l.value.yellowAlertDays},t[o.ALERTA_NARANJA]={value:l.value.orangeAlertDays},t[o.ALERTA_ROJA_CRITICA]={value:l.value.redAlertDays});const e=P(t);if(e.length>0){S("Error de validación: "+e.join(", "));return}const s=Object.keys(t);for(const p of s){const d=T.value[p],i=t[p];if(!d||i.value===null||i.value===void 0)continue;const n=Number(i.value);!Number.isNaN(n)&&n>0&&await j(_.update(d),{value:n})}V("Configuración guardada exitosamente."),y(),await C()}catch(t){const e=t?.response?.data?.message||t?.response?.data?.msg||t?.message||"Error al guardar la configuración.";S(e)}finally{f.value=!1}};return k(()=>{C()}),(t,e)=>(J(),G("div",K,[r(Q),a("div",W,[a("div",ee,[r(E,{class:"shadow-1 hero-card q-mb-xl"},{default:u(()=>[r(b,null,{default:u(()=>[r(z,{title:"Gestión de Alertas y Notificaciones Automáticas",description:"Administra reglas de notificación y alertas automáticas."})]),_:1})]),_:1})])]),a("div",ae,[r(E,{class:"section-card q-mb-lg"},{default:u(()=>[e[18]||(e[18]=a("div",{class:"section-header"},[a("div",{class:"header-title"},"Configuración de Fichas")],-1)),r(b,{class:"section-content"},{default:u(()=>[a("div",se,[e[11]||(e[11]=a("div",{class:"config-label-group"},[a("div",{class:"config-label"},"Fichas nuevas (posterior a noviembre 2024)"),a("div",{class:"config-sublabel"},"Tiempo límite sin registrar etapa productiva")],-1)),a("div",te,[r(c,{modelValue:l.value.newRecordsTime,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.newRecordsTime=s),type:"number",outlined:"",dense:"",class:"custom-select",min:"1",oninput:"this.value = this.value.replace(/[^0-9]/g, '')",rules:[s=>!!s||"Campo obligatorio",s=>s>0||"Debe ser mayor a 0"]},null,8,["modelValue","rules"]),e[10]||(e[10]=a("span",{class:"input-hint"},"Meses",-1))])]),a("div",le,[e[13]||(e[13]=a("div",{class:"config-label-group"},[a("div",{class:"config-label"},"Fichas antiguas (anterior a noviembre 2024)"),a("div",{class:"config-sublabel"},"Tiempo límite sin registrar etapa productiva")],-1)),a("div",oe,[r(c,{modelValue:l.value.oldRecordsTime,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.oldRecordsTime=s),type:"number",outlined:"",dense:"",class:"custom-select",min:"1",oninput:"this.value = this.value.replace(/[^0-9]/g, '')",rules:[s=>!!s||"Campo obligatorio",s=>s>0||"Debe ser mayor a 0"]},null,8,["modelValue","rules"]),e[12]||(e[12]=a("span",{class:"input-hint"},"Meses",-1))])]),a("div",re,[e[15]||(e[15]=a("div",{class:"config-label-group"},[a("div",{class:"config-label"},"Máximo de registros por aprendiz/ficha"),a("div",{class:"config-sublabel"},"Número máximo de registros permitidos por aprendiz en una ficha")],-1)),a("div",ie,[r(c,{modelValue:l.value.maxRecordsPerApprentice,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.maxRecordsPerApprentice=s),type:"number",outlined:"",dense:"",class:"custom-select",min:"1",oninput:"this.value = this.value.replace(/[^0-9]/g, '')",rules:[s=>!!s||"Campo obligatorio",s=>s>0||"Debe ser mayor a 0"]},null,8,["modelValue","rules"]),e[14]||(e[14]=a("span",{class:"input-hint"},"Registros",-1))])]),a("div",ne,[e[17]||(e[17]=a("div",{class:"config-label-group"},[a("div",{class:"config-label"},"Horas mensuales instructores"),a("div",{class:"config-sublabel"},"Límite de horas mensuales asignables por instructor")],-1)),a("div",ue,[r(c,{modelValue:l.value.monthlyInstructorHours,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.monthlyInstructorHours=s),type:"number",outlined:"",dense:"",class:"custom-select",min:"1",oninput:"this.value = this.value.replace(/[^0-9]/g, '')",rules:[s=>!!s||"Campo obligatorio",s=>s>0||"Debe ser mayor a 0"]},null,8,["modelValue","rules"]),e[16]||(e[16]=a("span",{class:"input-hint"},"Horas",-1))])]),a("div",de,[r(R,{label:"Guardar Configuración",onClick:e[4]||(e[4]=s=>N(m.FICHE)),"custom-class":"gradient-btn"})])]),_:1})]),_:1}),r(E,{class:"section-card q-mb-lg"},{default:u(()=>[e[25]||(e[25]=a("div",{class:"section-header"},[a("div",{class:"header-title"},"Alertas Escalonadas")],-1)),r(b,{class:"section-content"},{default:u(()=>[a("div",ce,[a("div",me,[e[20]||(e[20]=a("div",{class:"alert-label-group"},[a("div",{class:"alert-title"},"Amarilla"),a("div",{class:"alert-subtitle"},"Primera notificación preventiva")],-1)),a("div",Ae,[r(c,{modelValue:l.value.yellowAlertDays,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.yellowAlertDays=s),type:"number",outlined:"",dense:"",class:"alert-select",min:"16",oninput:"this.value = this.value.replace(/[^0-9]/g, '')",rules:[s=>!!s||"Campo obligatorio",s=>s>15||"Debe ser mayor a 15 días"]},null,8,["modelValue","rules"]),e[19]||(e[19]=a("span",{class:"alert-hint"},"días antes del vencimiento",-1))])])]),a("div",ve,[a("div",pe,[e[22]||(e[22]=a("div",{class:"alert-label-group"},[a("div",{class:"alert-title"},"Naranja"),a("div",{class:"alert-subtitle"},"Notificación de atención urgente")],-1)),a("div",ge,[r(c,{modelValue:l.value.orangeAlertDays,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.orangeAlertDays=s),type:"number",outlined:"",dense:"",class:"alert-select",min:"7",max:"15",oninput:"this.value = this.value.replace(/[^0-9]/g, '')",rules:[s=>!!s||"Campo obligatorio",s=>s>7||"Debe ser mayor a 7 días",s=>s<=15||"Debe ser menor o igual a 15 días"]},null,8,["modelValue","rules"]),e[21]||(e[21]=a("span",{class:"alert-hint"},"días antes del vencimiento",-1))])])]),a("div",Re,[a("div",fe,[e[24]||(e[24]=a("div",{class:"alert-label-group"},[a("div",{class:"alert-title"},"Roja"),a("div",{class:"alert-subtitle"},"Notificación crítica inmediata")],-1)),a("div",Ee,[r(c,{modelValue:l.value.redAlertDays,"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.redAlertDays=s),type:"number",outlined:"",dense:"",class:"alert-select",min:"1",max:"7",oninput:"this.value = this.value.replace(/[^0-9]/g, '')",rules:[s=>!!s||"Campo obligatorio",s=>s<=7||"Debe ser menor o igual a 7 días",s=>s>0||"Debe ser mayor a 0"]},null,8,["modelValue","rules"]),e[23]||(e[23]=a("span",{class:"alert-hint"},"días antes del vencimiento",-1))])])]),a("div",be,[r(R,{label:"Guardar Configuración",onClick:e[8]||(e[8]=s=>N(m.ESCALATED)),"custom-class":"gradient-btn"})])]),_:1})]),_:1})]),r(Y,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=s=>v.value=s),width:"500px","max-width":"95vw",persistent:""},{header:u(()=>[a("div",_e,[a("div",Ie,[r(X,{name:"help",class:"q-mr-sm"}),e[26]||(e[26]=$(" Confirmación de Cambios ",-1))])])]),body:u(()=>[a("div",Se,[e[27]||(e[27]=a("div",{class:"text-h6 q-mb-md"},"¿Está seguro de que desea guardar los cambios?",-1)),a("p",{class:"confirmation-text text-body1",innerHTML:H()},null,8,Te)])]),footer:u(()=>[a("div",Ce,[r(R,{label:"Cancelar","custom-class":"boton-cerrar",onClick:y}),r(R,{label:"Aceptar","custom-class":"gradient-btn",onClick:U,loading:q(f)},null,8,["loading"])])]),_:1},8,["modelValue"])]))}},Pe=F(Ne,[["__scopeId","data-v-44bda6ce"]]);export{Pe as default};
