import{_ as F,r as p,m as q,c as V,a as n,o as i,b as a,d as e,h as y,g as k,f as d,s as c,j as h,t as _,ad as H,a9 as O,q as Z}from"./index-D8k0Z2VW.js";import{Q as L,C as R}from"./auto-BTcMSK3N.js";import{Q as W}from"./QPage-CDUm3vNP.js";import{g as w}from"./apiClient-Vvvjylwf.js";import{u as G}from"./useNotifications-C15CMF32.js";import{B as K}from"./BackButton-OAicZK4q.js";import{B as U}from"./Button-ByZOtwGJ.js";import{P as X}from"./PageHeader-BZtJRD6F.js";const tt={class:"full-width row"},et={class:"col-12"},st={class:"actions-wrapper flex justify-end q-my-lg"},at={key:0,class:"loading-state"},rt={key:1,class:"row q-col-gutter-md"},ot={class:"col-12"},nt={class:"chart-container-large"},lt={key:0,class:"empty-chart-message"},it={class:"col-12 col-md-6"},dt={class:"chart-container-medium"},ct={key:0,class:"empty-chart-message"},ut={class:"col-12 col-md-6"},mt={class:"chart-container-medium"},vt={key:0,class:"q-pa-md"},pt={class:"row q-col-gutter-md"},yt={class:"col-6 text-center"},gt={class:"text-h4 text-primary"},ft={class:"text-caption text-grey-6"},ht={class:"col-6 text-center"},_t={class:"text-h4 text-grey-7"},xt={class:"text-caption text-grey-6"},bt={class:"text-center"},Ct={class:"text-h6"},Mt={key:1,class:"empty-chart-message"},At={key:2,class:"empty-state"},qt={__name:"TemporalStatistic",setup(kt){const{error:E,success:z}=G(),g=p(!1),C=p(!1),u=p(null),m=p(null),r=p(null),M=p(null),A=p(null);let x=null,b=null;const S=q(()=>u.value&&Array.isArray(u.value)&&u.value.length>0),N=q(()=>m.value&&Array.isArray(m.value)&&m.value.length>0),Q=q(()=>r.value&&typeof r.value=="object"&&!Array.isArray(r.value)?r.value.currentMonth!==void 0||r.value.previousMonth!==void 0:!1),B=s=>{if(!s||!s._id)return"N/A";const t=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];return s._id.year&&s._id.month?`${t[s._id.month-1]} ${s._id.year}`:"N/A"},$=()=>{if(!r.value)return"";const s=r.value.currentMonth?.count||0,t=r.value.previousMonth?.count||0;return s>t?"text-positive":s<t?"text-negative":"text-grey-7"},I=()=>{if(!r.value)return"remove";const s=r.value.currentMonth?.count||0,t=r.value.previousMonth?.count||0;return s>t?"trending_up":s<t?"trending_down":"trending_flat"},T=()=>{if(!r.value)return"Sin cambios";const s=r.value.currentMonth?.count||0,t=r.value.previousMonth?.count||0;if(s===t)return"Sin cambios";const o=s-t,v=t===0?100:(o/t*100).toFixed(1);return o>0?`+${o} (${v}%)`:`${o} (${v}%)`},P=async()=>{g.value=!0,C.value=!1;try{const[s,t,o]=await Promise.all([w("/statistics/registrations-by-month?months=12").catch(l=>(console.error("Error en registrations-by-month:",l),null)),w("/statistics/registrations-by-year?years=5").catch(l=>(console.error("Error en registrations-by-year:",l),null)),w("/statistics/monthly-comparison").catch(l=>(console.error("Error en monthly-comparison:",l),null))]),v=l=>{if(!l)return null;const f=l.data||l;return Array.isArray(f)||typeof f=="object",f};u.value=v(s),m.value=v(t),r.value=v(o),C.value=!0,console.log("Estadísticas cargadas:",{registrationsByMonth:u.value,registrationsByYear:m.value,monthlyComparison:r.value}),z("Estadísticas cargadas correctamente"),await Z(),J()}catch(s){console.error("Error general al cargar estadísticas:",s);const t=s?.response?.data?.msg||s?.message||"Error al cargar estadísticas";E(t)}finally{g.value=!1}},j=()=>{x&&(x.destroy(),x=null),b&&(b.destroy(),b=null)},J=()=>{j(),setTimeout(()=>{S.value&&M.value&&(console.log("Renderizando monthChart con datos:",u.value),Y()),N.value&&A.value&&(console.log("Renderizando yearChart con datos:",m.value),D())},100)},Y=()=>{const s=M.value.getContext("2d"),t=u.value;x=new R(s,{type:"line",data:{labels:t.map(o=>o._id&&o._id.year&&o._id.month?`${["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][o._id.month-1]} ${o._id.year}`:"Sin fecha"),datasets:[{label:"Registros",data:t.map(o=>o.count),borderColor:"rgba(52, 152, 219, 1)",backgroundColor:"rgba(52, 152, 219, 0.1)",tension:.4,fill:!0,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"rgba(52, 152, 219, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}},plugins:{legend:{display:!1}}}})},D=()=>{const s=A.value.getContext("2d"),t=m.value;b=new R(s,{type:"bar",data:{labels:t.map(o=>o._id&&o._id.year?o._id.year.toString():"Sin año"),datasets:[{label:"Registros",data:t.map(o=>o.count),backgroundColor:"rgba(46, 204, 113, 0.7)",borderColor:"rgba(46, 204, 113, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}},plugins:{legend:{display:!1}}}})};return(s,t)=>(i(),V(W,{class:"q-pa-md temporal-statistics-page"},{default:n(()=>[a(K,{class:"q-mb-lg"}),e("div",tt,[e("div",et,[a(d,{class:"shadow-1 hero-card q-mb-xl"},{default:n(()=>[a(c,null,{default:n(()=>[a(X,{title:"Estadísticas Temporales",description:"Indicadores y análisis temporales de registros en el sistema."})]),_:1})]),_:1}),e("div",st,[a(U,{label:"Cargar Estadísticas","custom-class":"gradient-btn",icon:"analytics",onClick:P,loading:g.value},null,8,["loading"])]),g.value?(i(),y("div",at,[a(d,{class:"shadow-1"},{default:n(()=>[a(c,{class:"text-center q-pa-xl"},{default:n(()=>[a(L,{size:"64px",color:"primary"}),t[0]||(t[0]=e("div",{class:"text-h6 q-mt-md text-grey-7"}," Cargando estadísticas temporales... ",-1))]),_:1})]),_:1})])):C.value?(i(),y("div",rt,[e("div",ot,[a(d,{class:"shadow-1"},{default:n(()=>[a(c,null,{default:n(()=>[t[2]||(t[2]=e("div",{class:"text-h6 q-mb-md"},"Registros de Aprendices por Mes",-1)),t[3]||(t[3]=e("div",{class:"text-caption text-grey-7 q-mb-md"}," Últimos 12 meses ",-1)),e("div",nt,[e("canvas",{ref_key:"monthChart",ref:M},null,512),S.value?k("",!0):(i(),y("div",lt,[a(h,{name:"calendar_month",size:"48px",color:"grey-4"}),t[1]||(t[1]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de registros por mes ",-1))]))])]),_:1})]),_:1})]),e("div",it,[a(d,{class:"shadow-1"},{default:n(()=>[a(c,null,{default:n(()=>[t[5]||(t[5]=e("div",{class:"text-h6 q-mb-md"},"Registros de Aprendices por Año",-1)),t[6]||(t[6]=e("div",{class:"text-caption text-grey-7 q-mb-md"}," Últimos 5 años ",-1)),e("div",dt,[e("canvas",{ref_key:"yearChart",ref:A},null,512),N.value?k("",!0):(i(),y("div",ct,[a(h,{name:"calendar_today",size:"48px",color:"grey-4"}),t[4]||(t[4]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de registros por año ",-1))]))])]),_:1})]),_:1})]),e("div",ut,[a(d,{class:"shadow-1"},{default:n(()=>[a(c,null,{default:n(()=>[t[10]||(t[10]=e("div",{class:"text-h6 q-mb-md"},"Comparación Mensual",-1)),t[11]||(t[11]=e("div",{class:"text-caption text-grey-7 q-mb-md"}," Mes actual vs mes anterior ",-1)),e("div",mt,[Q.value?(i(),y("div",vt,[e("div",pt,[e("div",yt,[a(d,{flat:"",bordered:""},{default:n(()=>[a(c,null,{default:n(()=>[e("div",gt,_(r.value.currentMonth?.count||0),1),t[7]||(t[7]=e("div",{class:"text-subtitle2 text-grey-7"},"Mes Actual",-1)),e("div",ft,_(B(r.value.currentMonth)),1)]),_:1})]),_:1})]),e("div",ht,[a(d,{flat:"",bordered:""},{default:n(()=>[a(c,null,{default:n(()=>[e("div",_t,_(r.value.previousMonth?.count||0),1),t[8]||(t[8]=e("div",{class:"text-subtitle2 text-grey-7"},"Mes Anterior",-1)),e("div",xt,_(B(r.value.previousMonth)),1)]),_:1})]),_:1})])]),a(H,{class:"q-my-md"}),e("div",bt,[e("div",{class:O($())},[a(h,{name:I(),size:"32px"},null,8,["name"]),e("div",Ct,_(T()),1)],2)])])):(i(),y("div",Mt,[a(h,{name:"compare_arrows",size:"48px",color:"grey-4"}),t[9]||(t[9]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de comparación mensual ",-1))]))])]),_:1})]),_:1})])])):g.value?k("",!0):(i(),y("div",At,[a(d,{class:"shadow-1"},{default:n(()=>[a(c,{class:"text-center q-pa-xl"},{default:n(()=>[a(h,{name:"folder",size:"64px",color:"grey-5"}),t[12]||(t[12]=e("div",{class:"text-h6 q-mt-md text-grey-7"}," No hay estadísticas disponibles ",-1)),t[13]||(t[13]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"},' Presiona "Cargar Estadísticas" para visualizar los datos ',-1))]),_:1})]),_:1})]))])])]),_:1}))}},$t=F(qt,[["__scopeId","data-v-8e7f5b00"]]);export{$t as default};
