import{_ as aa,r as l,m as k,c as ta,a as r,o as i,b as s,d as t,h as u,g as h,f as v,s as p,j as b,q as ea}from"./index-D8k0Z2VW.js";import{Q as sa,C as A}from"./auto-BTcMSK3N.js";import{Q as oa}from"./QPage-CDUm3vNP.js";import{g as w}from"./apiClient-Vvvjylwf.js";import{u as ra}from"./useNotifications-C15CMF32.js";import{B as na}from"./BackButton-OAicZK4q.js";import{B as la}from"./Button-ByZOtwGJ.js";import{P as ia}from"./PageHeader-BZtJRD6F.js";import{T as da}from"./Table-DrGgNztj.js";import"./QList-D6hH9GPe.js";import"./QSelect-CCFBgF8v.js";import"./QItemLabel-BiKvV_tR.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";import"./QLinearProgress-C9Sex94R.js";const ca={class:"full-width row"},ua={class:"col-12"},ma={class:"actions-wrapper flex justify-end q-my-lg"},va={key:0,class:"loading-state"},pa={key:1,class:"row q-col-gutter-md"},ga={class:"col-12 col-md-6"},fa={class:"chart-container-medium"},ya={key:0,class:"empty-chart-message"},ha={class:"col-12 col-md-6"},ba={class:"chart-container-medium"},xa={key:0,class:"empty-chart-message"},_a={class:"col-12 col-md-6"},Ca={class:"chart-container-medium"},ka={key:0,class:"empty-chart-message"},Aa={class:"col-12 col-md-6"},wa={class:"chart-container-medium"},qa={key:0,class:"empty-chart-message"},Sa={class:"col-12"},Ra={class:"chart-container-large"},za={key:0,class:"empty-chart-message"},Ea={key:0,class:"q-mt-md"},Na={key:1,class:"text-center q-pa-md text-grey-6"},Fa={key:2,class:"empty-state"},Ia={__name:"FichesStatistic",setup(Pa){const{error:W,success:L}=ra(),x=l(!1),N=l(!1),g=l(null),f=l(null),y=l(null),d=l(null),m=l(null),F=l(null),I=l(null),P=l(null),D=l(null),B=l(null);let q=null,S=null,R=null,z=null,E=null;const Q=k(()=>g.value&&Array.isArray(g.value)&&g.value.length>0),V=k(()=>f.value&&Array.isArray(f.value)&&f.value.length>0),M=k(()=>y.value&&Array.isArray(y.value)&&y.value.length>0),j=k(()=>d.value&&typeof d.value=="object"&&!Array.isArray(d.value)?d.value.expiringSoon>0||d.value.expired>0:!1),T=k(()=>m.value&&typeof m.value=="object"&&!Array.isArray(m.value)?m.value.active!==void 0||m.value.inactive!==void 0:!1),Z=[{name:"number",label:"Número de Ficha",align:"left",field:"number"},{name:"program",label:"Programa",align:"left",field:o=>o.program?.name||"Sin programa"},{name:"owner",label:"Responsable",align:"left",field:o=>o.owner?.name||"Sin responsable"},{name:"fend",label:"Fecha de Fin",align:"center",field:"fend",format:o=>o?new Date(o).toLocaleDateString("es-ES"):"N/A"}],H=async()=>{x.value=!0,N.value=!1;try{const[o,a,e,c,$]=await Promise.all([w("/statistics/fiches/by-program").catch(n=>(console.error("Error en by-program:",n),null)),w("/statistics/fiches/by-modality").catch(n=>(console.error("Error en by-modality:",n),null)),w("/statistics/fiches/by-coordination").catch(n=>(console.error("Error en by-coordination:",n),null)),w("/statistics/fiches/expiration-alert").catch(n=>(console.error("Error en expiration-alert:",n),null)),w("/statistics/fiches/active-vs-inactive").catch(n=>(console.error("Error en active-vs-inactive:",n),null))]),_=n=>{if(!n)return null;const C=n.data||n;return Array.isArray(C)||typeof C=="object",C};g.value=_(o),f.value=_(a),y.value=_(e),d.value=_(c),m.value=_($),N.value=!0,console.log("Estadísticas cargadas:",{byProgram:g.value,byModality:f.value,byCoordination:y.value,expirationAlert:d.value,activeVsInactive:m.value}),L("Estadísticas cargadas correctamente"),await ea(),J()}catch(o){console.error("Error general al cargar estadísticas:",o);const a=o?.response?.data?.msg||o?.message||"Error al cargar estadísticas";W(a)}finally{x.value=!1}},G=()=>{q&&(q.destroy(),q=null),S&&(S.destroy(),S=null),R&&(R.destroy(),R=null),z&&(z.destroy(),z=null),E&&(E.destroy(),E=null)},J=()=>{G(),setTimeout(()=>{Q.value&&F.value&&(console.log("Renderizando programChart con datos:",g.value),K()),V.value&&I.value&&(console.log("Renderizando modalityChart con datos:",f.value),O()),M.value&&P.value&&(console.log("Renderizando coordinationChart con datos:",y.value),U()),j.value&&D.value&&(console.log("Renderizando expirationChart con datos:",d.value),X()),T.value&&B.value&&(console.log("Renderizando activeChart con datos:",m.value),Y())},100)},K=()=>{const o=F.value.getContext("2d"),a=g.value.slice(0,10);q=new A(o,{type:"pie",data:{labels:a.map(e=>typeof e._id=="object"&&e._id!==null?e._id.programName||"Sin programa":e._id||"Sin programa"),datasets:[{data:a.map(e=>e.count),backgroundColor:["rgba(45, 178, 0, 0.8)","rgba(52, 152, 219, 0.8)","rgba(155, 89, 182, 0.8)","rgba(241, 196, 15, 0.8)","rgba(231, 76, 60, 0.8)","rgba(26, 188, 156, 0.8)","rgba(230, 126, 34, 0.8)","rgba(52, 73, 94, 0.8)","rgba(149, 165, 166, 0.8)","rgba(243, 156, 18, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{maxWidth:200,font:{size:10},padding:5}},tooltip:{callbacks:{label:function(e){let c=e.label||"";return c&&(c+=": "),c+=e.parsed+" fichas",c}}}}}})},O=()=>{const o=I.value.getContext("2d"),a=f.value;S=new A(o,{type:"doughnut",data:{labels:a.map(e=>e._id===null||e._id===void 0?"Sin modalidad":e._id),datasets:[{data:a.map(e=>e.count),backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(52, 152, 219, 0.8)","rgba(155, 89, 182, 0.8)","rgba(241, 196, 15, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},U=()=>{const o=P.value.getContext("2d"),a=y.value;R=new A(o,{type:"bar",data:{labels:a.map(e=>typeof e._id=="object"&&e._id!==null?e._id.coordinationName||"Sin coordinación":e._id||"Sin coordinación"),datasets:[{label:"Fichas",data:a.map(e=>e.count),backgroundColor:"rgba(155, 89, 182, 0.7)",borderColor:"rgba(155, 89, 182, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})},X=()=>{const o=D.value.getContext("2d"),a=d.value,e=["Próximas a vencer","Vencidas"],c=[a.expiringSoon||0,a.expired||0];z=new A(o,{type:"bar",data:{labels:e,datasets:[{label:"Fichas",data:c,backgroundColor:["rgba(241, 196, 15, 0.7)","rgba(231, 76, 60, 0.7)"],borderColor:["rgba(241, 196, 15, 1)","rgba(231, 76, 60, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{beginAtZero:!0,ticks:{stepSize:1}}}}})},Y=()=>{const o=B.value.getContext("2d"),a=m.value,e=["Activas","Inactivas"],c=[a.active||0,a.inactive||0];E=new A(o,{type:"doughnut",data:{labels:e,datasets:[{data:c,backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(231, 76, 60, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})};return(o,a)=>(i(),ta(oa,{class:"q-pa-md fiches-statistics-page"},{default:r(()=>[s(na,{class:"q-mb-lg"}),t("div",ca,[t("div",ua,[s(v,{class:"shadow-1 hero-card q-mb-xl"},{default:r(()=>[s(p,null,{default:r(()=>[s(ia,{title:"Estadísticas de Fichas",description:"Indicadores y análisis de fichas del sistema."})]),_:1})]),_:1}),t("div",ma,[s(la,{label:"Cargar Estadísticas","custom-class":"gradient-btn",icon:"analytics",onClick:H,loading:x.value},null,8,["loading"])]),x.value?(i(),u("div",va,[s(v,{class:"shadow-1"},{default:r(()=>[s(p,{class:"text-center q-pa-xl"},{default:r(()=>[s(sa,{size:"64px",color:"primary"}),a[0]||(a[0]=t("div",{class:"text-h6 q-mt-md text-grey-7"}," Cargando estadísticas de fichas... ",-1))]),_:1})]),_:1})])):N.value?(i(),u("div",pa,[t("div",ga,[s(v,{class:"shadow-1"},{default:r(()=>[s(p,null,{default:r(()=>[a[2]||(a[2]=t("div",{class:"text-h6 q-mb-md"},"Fichas por Programa (Top 10)",-1)),t("div",fa,[t("canvas",{ref_key:"programChart",ref:F},null,512),Q.value?h("",!0):(i(),u("div",ya,[s(b,{name:"pie_chart",size:"48px",color:"grey-4"}),a[1]||(a[1]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de fichas por programa ",-1))]))])]),_:1})]),_:1})]),t("div",ha,[s(v,{class:"shadow-1"},{default:r(()=>[s(p,null,{default:r(()=>[a[4]||(a[4]=t("div",{class:"text-h6 q-mb-md"},"Fichas por Modalidad",-1)),t("div",ba,[t("canvas",{ref_key:"modalityChart",ref:I},null,512),V.value?h("",!0):(i(),u("div",xa,[s(b,{name:"donut_small",size:"48px",color:"grey-4"}),a[3]||(a[3]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de fichas por modalidad ",-1))]))])]),_:1})]),_:1})]),t("div",_a,[s(v,{class:"shadow-1"},{default:r(()=>[s(p,null,{default:r(()=>[a[6]||(a[6]=t("div",{class:"text-h6 q-mb-md"},"Fichas por Coordinación",-1)),t("div",Ca,[t("canvas",{ref_key:"coordinationChart",ref:P},null,512),M.value?h("",!0):(i(),u("div",ka,[s(b,{name:"bar_chart",size:"48px",color:"grey-4"}),a[5]||(a[5]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de fichas por coordinación ",-1))]))])]),_:1})]),_:1})]),t("div",Aa,[s(v,{class:"shadow-1"},{default:r(()=>[s(p,null,{default:r(()=>[a[8]||(a[8]=t("div",{class:"text-h6 q-mb-md"},"Fichas Activas vs Inactivas",-1)),t("div",wa,[t("canvas",{ref_key:"activeChart",ref:B},null,512),T.value?h("",!0):(i(),u("div",qa,[s(b,{name:"donut_large",size:"48px",color:"grey-4"}),a[7]||(a[7]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de fichas activas vs inactivas ",-1))]))])]),_:1})]),_:1})]),t("div",Sa,[s(v,{class:"shadow-1"},{default:r(()=>[s(p,null,{default:r(()=>[a[10]||(a[10]=t("div",{class:"text-h6 q-mb-md"},"Alerta de Vencimiento de Fichas",-1)),a[11]||(a[11]=t("div",{class:"text-caption text-grey-7 q-mb-md"}," Fichas próximas a vencer (30 días) y vencidas ",-1)),t("div",Ra,[t("canvas",{ref_key:"expirationChart",ref:D},null,512),j.value?h("",!0):(i(),u("div",za,[s(b,{name:"event",size:"48px",color:"grey-4"}),a[9]||(a[9]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de fichas próximas a vencer ",-1))]))]),j.value?(i(),u("div",Ea,[s(da,{card:"",rows:d.value.fiches||[],columns:Z,"row-key":"_id"},null,8,["rows"])])):(i(),u("div",Na," No hay datos para mostrar en la tabla "))]),_:1})]),_:1})])])):x.value?h("",!0):(i(),u("div",Fa,[s(v,{class:"shadow-1"},{default:r(()=>[s(p,{class:"text-center q-pa-xl"},{default:r(()=>[s(b,{name:"folder",size:"64px",color:"grey-5"}),a[12]||(a[12]=t("div",{class:"text-h6 q-mt-md text-grey-7"}," No hay estadísticas disponibles ",-1)),a[13]||(a[13]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"},' Presiona "Cargar Estadísticas" para visualizar los datos ',-1))]),_:1})]),_:1})]))])])]),_:1}))}},Xa=aa(Ia,[["__scopeId","data-v-79945919"]]);export{Xa as default};
