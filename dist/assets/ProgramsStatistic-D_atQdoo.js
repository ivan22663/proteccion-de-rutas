import{_ as W,r as n,m as E,c as Z,a as r,o as u,b as s,d as t,h as m,g as b,f as p,s as g,j as x,q as F}from"./index-D8k0Z2VW.js";import{Q as H,C as R}from"./auto-BTcMSK3N.js";import{Q as M}from"./QPage-CDUm3vNP.js";import{g as S}from"./apiClient-Vvvjylwf.js";import{u as G}from"./useNotifications-C15CMF32.js";import{B as J}from"./BackButton-OAicZK4q.js";import{B as K}from"./Button-ByZOtwGJ.js";import{P as O}from"./PageHeader-BZtJRD6F.js";const U={class:"full-width row"},X={class:"col-12"},Y={class:"actions-wrapper flex justify-end q-my-lg"},$={key:0,class:"loading-state"},aa={key:1,class:"row q-col-gutter-md"},ea={class:"col-12 col-md-6"},ta={class:"chart-container-medium"},sa={key:0,class:"empty-chart-message"},ra={class:"col-12 col-md-6"},la={class:"chart-container-medium"},oa={key:0,class:"empty-chart-message"},na={class:"col-12"},da={class:"chart-container-large"},ia={key:0,class:"empty-chart-message"},ca={key:2,class:"empty-state"},ua={__name:"ProgramsStatistic",setup(ma){const{error:N,success:Q}=G(),v=n(!1),C=n(!1),d=n(null),i=n(null),c=n(null),k=n(null),q=n(null),w=n(null);let y=null,_=null,h=null;const P=E(()=>d.value&&Array.isArray(d.value)&&d.value.length>0),z=E(()=>i.value&&Array.isArray(i.value)&&i.value.length>0),B=E(()=>c.value&&Array.isArray(c.value)&&c.value.length>0),j=async()=>{v.value=!0,C.value=!1;try{const[l,e,a]=await Promise.all([S("/statistics/programs/by-level").catch(o=>(console.error("Error en by-level:",o),null)),S("/statistics/programs/enrollment").catch(o=>(console.error("Error en enrollment:",o),null)),S("/statistics/programs/completion-rate").catch(o=>(console.error("Error en completion-rate:",o),null))]),A=o=>{if(!o)return null;const f=o.data||o;return Array.isArray(f)||typeof f=="object",f};d.value=A(l),i.value=A(e),c.value=A(a),C.value=!0,console.log("Estadísticas cargadas:",{byLevel:d.value,enrollment:i.value,completionRate:c.value}),Q("Estadísticas cargadas correctamente"),await F(),D()}catch(l){console.error("Error general al cargar estadísticas:",l);const e=l?.response?.data?.msg||l?.message||"Error al cargar estadísticas";N(e)}finally{v.value=!1}},I=()=>{y&&(y.destroy(),y=null),_&&(_.destroy(),_=null),h&&(h.destroy(),h=null)},D=()=>{I(),setTimeout(()=>{P.value&&k.value&&(console.log("Renderizando levelChart con datos:",d.value),L()),z.value&&q.value&&(console.log("Renderizando enrollmentChart con datos:",i.value),T()),B.value&&w.value&&(console.log("Renderizando completionChart con datos:",c.value),V())},100)},L=()=>{const l=k.value.getContext("2d"),e=d.value;y=new R(l,{type:"doughnut",data:{labels:e.map(a=>typeof a._id=="object"&&a._id!==null?a._id.name||a._id.level||"Sin nivel":a._id===null||a._id===void 0?"Sin nivel":a._id),datasets:[{data:e.map(a=>a.count),backgroundColor:["rgba(52, 152, 219, 0.8)","rgba(46, 204, 113, 0.8)","rgba(155, 89, 182, 0.8)","rgba(241, 196, 15, 0.8)","rgba(231, 76, 60, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},T=()=>{const l=q.value.getContext("2d"),e=i.value;_=new R(l,{type:"bar",data:{labels:e.map(a=>typeof a._id=="object"&&a._id!==null?a._id.name||a._id.program||"Sin programa":a._id===null||a._id===void 0?"Sin programa":a._id),datasets:[{label:"Aprendices",data:e.map(a=>a.count||a.enrollment||0),backgroundColor:"rgba(52, 152, 219, 0.7)",borderColor:"rgba(52, 152, 219, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}},plugins:{legend:{display:!1}}}})},V=()=>{const l=w.value.getContext("2d"),e=c.value;h=new R(l,{type:"bar",data:{labels:e.map(a=>typeof a._id=="object"&&a._id!==null?a._id.name||a._id.program||"Sin programa":a._id===null||a._id===void 0?"Sin programa":a._id),datasets:[{label:"Tasa de Completitud (%)",data:e.map(a=>a.completionRate||a.rate||0),backgroundColor:"rgba(46, 204, 113, 0.7)",borderColor:"rgba(46, 204, 113, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{beginAtZero:!0,max:100,ticks:{callback:function(a){return a+"%"}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(a){return a.parsed.x.toFixed(1)+"%"}}}}}})};return(l,e)=>(u(),Z(M,{class:"q-pa-md programs-statistics-page"},{default:r(()=>[s(J,{class:"q-mb-lg"}),t("div",U,[t("div",X,[s(p,{class:"shadow-1 hero-card q-mb-xl"},{default:r(()=>[s(g,null,{default:r(()=>[s(O,{title:"Estadísticas de Programas",description:"Indicadores y análisis de programas formativos del sistema."})]),_:1})]),_:1}),t("div",Y,[s(K,{label:"Cargar Estadísticas","custom-class":"gradient-btn",icon:"analytics",onClick:j,loading:v.value},null,8,["loading"])]),v.value?(u(),m("div",$,[s(p,{class:"shadow-1"},{default:r(()=>[s(g,{class:"text-center q-pa-xl"},{default:r(()=>[s(H,{size:"64px",color:"primary"}),e[0]||(e[0]=t("div",{class:"text-h6 q-mt-md text-grey-7"}," Cargando estadísticas de programas... ",-1))]),_:1})]),_:1})])):C.value?(u(),m("div",aa,[t("div",ea,[s(p,{class:"shadow-1"},{default:r(()=>[s(g,null,{default:r(()=>[e[2]||(e[2]=t("div",{class:"text-h6 q-mb-md"},"Programas por Nivel",-1)),t("div",ta,[t("canvas",{ref_key:"levelChart",ref:k},null,512),P.value?b("",!0):(u(),m("div",sa,[s(x,{name:"pie_chart",size:"48px",color:"grey-4"}),e[1]||(e[1]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de programas por nivel ",-1))]))])]),_:1})]),_:1})]),t("div",ra,[s(p,{class:"shadow-1"},{default:r(()=>[s(g,null,{default:r(()=>[e[4]||(e[4]=t("div",{class:"text-h6 q-mb-md"},"Matrícula por Programa",-1)),t("div",la,[t("canvas",{ref_key:"enrollmentChart",ref:q},null,512),z.value?b("",!0):(u(),m("div",oa,[s(x,{name:"bar_chart",size:"48px",color:"grey-4"}),e[3]||(e[3]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de matrícula por programa ",-1))]))])]),_:1})]),_:1})]),t("div",na,[s(p,{class:"shadow-1"},{default:r(()=>[s(g,null,{default:r(()=>[e[6]||(e[6]=t("div",{class:"text-h6 q-mb-md"},"Tasa de Completitud por Programa",-1)),e[7]||(e[7]=t("div",{class:"text-caption text-grey-7 q-mb-md"}," En desarrollo ",-1)),t("div",da,[t("canvas",{ref_key:"completionChart",ref:w},null,512),B.value?b("",!0):(u(),m("div",ia,[s(x,{name:"trending_up",size:"48px",color:"grey-4"}),e[5]||(e[5]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de tasa de completitud ",-1))]))])]),_:1})]),_:1})])])):v.value?b("",!0):(u(),m("div",ca,[s(p,{class:"shadow-1"},{default:r(()=>[s(g,{class:"text-center q-pa-xl"},{default:r(()=>[s(x,{name:"folder",size:"64px",color:"grey-5"}),e[8]||(e[8]=t("div",{class:"text-h6 q-mt-md text-grey-7"}," No hay estadísticas disponibles ",-1)),e[9]||(e[9]=t("div",{class:"text-body2 text-grey-6 q-mt-sm"},' Presiona "Cargar Estadísticas" para visualizar los datos ',-1))]),_:1})]),_:1})]))])])]),_:1}))}},xa=W(ua,[["__scopeId","data-v-146fea42"]]);export{xa as default};
