import{_ as tt,r as d,m as k,c as at,a as l,o as u,b as e,d as a,h as p,g as _,f as v,s as y,j as C,q as et}from"./index-D8k0Z2VW.js";import{Q as st,C as S}from"./auto-BTcMSK3N.js";import{Q as ot}from"./QPage-CDUm3vNP.js";import{g as w}from"./apiClient-Vvvjylwf.js";import{u as rt}from"./useNotifications-C15CMF32.js";import{B as lt}from"./BackButton-OAicZK4q.js";import{B as nt}from"./Button-ByZOtwGJ.js";import{P as it}from"./PageHeader-BZtJRD6F.js";import{T as dt}from"./Table-DrGgNztj.js";import"./QList-D6hH9GPe.js";import"./QSelect-CCFBgF8v.js";import"./QItemLabel-BiKvV_tR.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";import"./QLinearProgress-C9Sex94R.js";const ct={class:"full-width row"},ut={class:"col-12"},pt={class:"actions-wrapper flex justify-end q-my-lg"},mt={key:0,class:"loading-state"},vt={key:1,class:"row q-col-gutter-md"},yt={class:"col-12 col-md-6"},gt={class:"chart-container-medium"},bt={key:0,class:"empty-chart-message"},ht={class:"col-12 col-md-6"},ft={class:"chart-container-medium"},_t={key:0,class:"empty-chart-message"},Ct={class:"col-12 col-md-6"},xt={class:"chart-container-medium"},At={key:0,class:"empty-chart-message"},kt={class:"col-12 col-md-6"},St={class:"chart-container-medium"},wt={key:0,class:"empty-chart-message"},qt={class:"col-12"},Rt={class:"chart-container-large"},zt={key:0,class:"empty-chart-message"},Et={key:0,class:"q-mt-md"},It={key:1,class:"text-center q-pa-md text-grey-6"},Pt={key:2,class:"empty-state"},Tt={__name:"ActivitiesStatistic",setup(Bt){const{error:Z,success:H}=rt(),x=d(!1),P=d(!1),g=d(null),b=d(null),h=d(null),c=d(null),m=d(null),T=d(null),B=d(null),N=d(null),j=d(null),D=d(null);let q=null,R=null,z=null,E=null,I=null;const V=k(()=>g.value&&Array.isArray(g.value)&&g.value.length>0),O=k(()=>b.value&&Array.isArray(b.value)&&b.value.length>0),W=k(()=>h.value&&Array.isArray(h.value)&&h.value.length>0),K=k(()=>c.value?typeof c.value=="object"&&!Array.isArray(c.value)?Object.values(c.value).some(t=>typeof t=="number"&&t>0):Array.isArray(c.value)?c.value.length>0:!0:!1),Q=k(()=>m.value&&Array.isArray(m.value)&&m.value.length>0),L=[{name:"_id",label:"Instructor",align:"left",field:"_id"},{name:"count",label:"Actividades Pendientes",align:"center",field:"count"}],F=async()=>{x.value=!0,P.value=!1;try{const[r,t,s,A,n]=await Promise.all([w("/statistics/activities/by-type").catch(o=>(console.error("Error en by-type:",o),null)),w("/statistics/activities/by-status").catch(o=>(console.error("Error en by-status:",o),null)),w("/statistics/activities/by-payment-status").catch(o=>(console.error("Error en by-payment-status:",o),null)),w("/statistics/activities/completion-rate").catch(o=>(console.error("Error en completion-rate:",o),null)),w("/statistics/activities/pending-by-instructor").catch(o=>(console.error("Error en pending-by-instructor:",o),null))]),i=o=>{if(!o)return null;const f=o.data||o;return Array.isArray(f)||typeof f=="object",f};g.value=i(r),b.value=i(t),h.value=i(s),c.value=i(A),m.value=i(n),P.value=!0,console.log("Estadísticas cargadas:",{byType:g.value,byStatus:b.value,byPaymentStatus:h.value,completionRate:c.value,pendingByInstructor:m.value}),H("Estadísticas cargadas correctamente"),await et(),J()}catch(r){console.error("Error general al cargar estadísticas:",r);const t=r?.response?.data?.msg||r?.message||"Error al cargar estadísticas";Z(t)}finally{x.value=!1}},G=()=>{q&&(q.destroy(),q=null),R&&(R.destroy(),R=null),z&&(z.destroy(),z=null),E&&(E.destroy(),E=null),I&&(I.destroy(),I=null)},J=()=>{G(),V.value&&T.value&&(console.log("Renderizando typeChart con datos:",g.value),M()),O.value&&B.value&&(console.log("Renderizando statusChart con datos:",b.value),U()),W.value&&N.value&&(console.log("Renderizando paymentStatusChart con datos:",h.value),X()),c.value&&j.value&&(console.log("Renderizando completionChart con datos:",c.value),Y()),Q.value&&D.value&&(console.log("Renderizando instructorChart con datos:",m.value),$())},M=()=>{const r=T.value.getContext("2d"),t=g.value;q=new S(r,{type:"pie",data:{labels:t.map(s=>s._id||"Sin tipo"),datasets:[{data:t.map(s=>s.count),backgroundColor:["rgba(45, 178, 0, 0.8)","rgba(52, 152, 219, 0.8)","rgba(155, 89, 182, 0.8)","rgba(241, 196, 15, 0.8)","rgba(231, 76, 60, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},U=()=>{const r=B.value.getContext("2d"),t=b.value;R=new S(r,{type:"doughnut",data:{labels:t.map(s=>s._id||"Sin estado"),datasets:[{data:t.map(s=>s.count),backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(241, 196, 15, 0.8)","rgba(231, 76, 60, 0.8)","rgba(149, 165, 166, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},X=()=>{const r=N.value.getContext("2d"),t=h.value;z=new S(r,{type:"bar",data:{labels:t.map(s=>s._id||"Sin estado de pago"),datasets:[{label:"Actividades",data:t.map(s=>s.count),backgroundColor:"rgba(155, 89, 182, 0.7)",borderColor:"rgba(155, 89, 182, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})},Y=()=>{const r=j.value.getContext("2d"),t=c.value;let s=[],A=[];if(console.log("Datos de completion rate:",t),Array.isArray(t))A=t.map(n=>n._id||n.status||n.label||"Sin estado"),s=t.map(n=>n.count||n.value||n.percentage||0);else if(typeof t=="object"&&t!==null){const n={approved:"Aprobadas",rejected:"Rechazadas",pending:"Pendientes",total:"Total",completionRate:"Tasa de Completitud (%)",rejectionRate:"Tasa de Rechazo (%)"},i=["approved","rejected","pending"];A=i.map(o=>n[o]||o),s=i.map(o=>t[o]||0),s.every(o=>o===0)&&(s=[1,1,1])}else{console.warn("Estructura de datos no reconocida para completion rate");return}E=new S(r,{type:"doughnut",data:{labels:A,datasets:[{data:s,backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(231, 76, 60, 0.8)","rgba(241, 196, 15, 0.8)","rgba(52, 152, 219, 0.8)","rgba(155, 89, 182, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(n){let i=n.label||"";i&&(i+=": ");const o=t[Object.keys(t)[n.dataIndex]];return s.every(f=>f===1)&&o===0?i+="0":i+=n.parsed,i}}}}}})},$=()=>{const r=D.value.getContext("2d"),t=m.value;I=new S(r,{type:"bar",data:{labels:t.map(s=>s._id||"Sin instructor"),datasets:[{label:"Actividades Pendientes",data:t.map(s=>s.count),backgroundColor:"rgba(78, 205, 196, 0.7)",borderColor:"rgba(78, 205, 196, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{beginAtZero:!0,ticks:{stepSize:1}}}}})};return(r,t)=>(u(),at(ot,{class:"q-pa-md activities-statistics-page"},{default:l(()=>[e(lt,{class:"q-mb-lg"}),a("div",ct,[a("div",ut,[e(v,{class:"shadow-1 hero-card q-mb-xl"},{default:l(()=>[e(y,null,{default:l(()=>[e(it,{title:"Estadísticas de Actividades",description:"Indicadores y análisis de actividades del sistema."})]),_:1})]),_:1}),a("div",pt,[e(nt,{label:"Cargar Estadísticas","custom-class":"gradient-btn",icon:"analytics",onClick:F,loading:x.value},null,8,["loading"])]),x.value?(u(),p("div",mt,[e(v,{class:"shadow-1"},{default:l(()=>[e(y,{class:"text-center q-pa-xl"},{default:l(()=>[e(st,{size:"64px",color:"primary"}),t[0]||(t[0]=a("div",{class:"text-h6 q-mt-md text-grey-7"}," Cargando estadísticas de actividades... ",-1))]),_:1})]),_:1})])):P.value?(u(),p("div",vt,[a("div",yt,[e(v,{class:"shadow-1"},{default:l(()=>[e(y,null,{default:l(()=>[t[2]||(t[2]=a("div",{class:"text-h6 q-mb-md"},"Actividades por Tipo",-1)),a("div",gt,[a("canvas",{ref_key:"typeChart",ref:T},null,512),V.value?_("",!0):(u(),p("div",bt,[e(C,{name:"pie_chart",size:"48px",color:"grey-4"}),t[1]||(t[1]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de actividades por tipo ",-1))]))])]),_:1})]),_:1})]),a("div",ht,[e(v,{class:"shadow-1"},{default:l(()=>[e(y,null,{default:l(()=>[t[4]||(t[4]=a("div",{class:"text-h6 q-mb-md"},"Actividades por Estado",-1)),a("div",ft,[a("canvas",{ref_key:"statusChart",ref:B},null,512),O.value?_("",!0):(u(),p("div",_t,[e(C,{name:"donut_small",size:"48px",color:"grey-4"}),t[3]||(t[3]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de actividades por estado ",-1))]))])]),_:1})]),_:1})]),a("div",Ct,[e(v,{class:"shadow-1"},{default:l(()=>[e(y,null,{default:l(()=>[t[6]||(t[6]=a("div",{class:"text-h6 q-mb-md"},"Actividades por Estado de Pago",-1)),a("div",xt,[a("canvas",{ref_key:"paymentStatusChart",ref:N},null,512),W.value?_("",!0):(u(),p("div",At,[e(C,{name:"bar_chart",size:"48px",color:"grey-4"}),t[5]||(t[5]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de actividades por estado de pago ",-1))]))])]),_:1})]),_:1})]),a("div",kt,[e(v,{class:"shadow-1"},{default:l(()=>[e(y,null,{default:l(()=>[t[8]||(t[8]=a("div",{class:"text-h6 q-mb-md"},"Tasa de Completitud",-1)),a("div",St,[a("canvas",{ref_key:"completionChart",ref:j},null,512),K.value?_("",!0):(u(),p("div",wt,[e(C,{name:"donut_large",size:"48px",color:"grey-4"}),t[7]||(t[7]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de tasa de completitud ",-1))]))])]),_:1})]),_:1})]),a("div",qt,[e(v,{class:"shadow-1"},{default:l(()=>[e(y,null,{default:l(()=>[t[10]||(t[10]=a("div",{class:"text-h6 q-mb-md"},"Actividades Pendientes por Instructor",-1)),a("div",Rt,[a("canvas",{ref_key:"instructorChart",ref:D},null,512),Q.value?_("",!0):(u(),p("div",zt,[e(C,{name:"person",size:"48px",color:"grey-4"}),t[9]||(t[9]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de actividades pendientes por instructor ",-1))]))]),Q.value?(u(),p("div",Et,[e(dt,{card:"",rows:m.value,columns:L,"row-key":"_id"},null,8,["rows"])])):(u(),p("div",It," No hay datos para mostrar en la tabla "))]),_:1})]),_:1})])])):x.value?_("",!0):(u(),p("div",Pt,[e(v,{class:"shadow-1"},{default:l(()=>[e(y,{class:"text-center q-pa-xl"},{default:l(()=>[e(C,{name:"folder",size:"64px",color:"grey-5"}),t[11]||(t[11]=a("div",{class:"text-h6 q-mt-md text-grey-7"}," No hay estadísticas disponibles ",-1)),t[12]||(t[12]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"},' Presiona "Cargar Estadísticas" para visualizar los datos ',-1))]),_:1})]),_:1})]))])])]),_:1}))}},Xt=tt(Tt,[["__scopeId","data-v-6c0b2b4b"]]);export{Xt as default};
