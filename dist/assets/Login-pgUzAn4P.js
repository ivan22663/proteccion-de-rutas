import{r as p,w as y,c as b,a as s,u as w,o as m,b as l,d as a,Q as P,e as I,f as Q,g as R,h as V,i as x,F as U,j as A}from"./index-D8k0Z2VW.js";import{Q as _,a as z,l as F,b as M,c as q,d as L}from"./LogoSENABlanco-CtklxWB6.js";import{Q as C}from"./QSelect-CCFBgF8v.js";import{Q as j}from"./QForm-BHoNUr4c.js";import{Q as B}from"./QPageContainer-CjE1gXqS.js";import{p as Z}from"./apiClient-Vvvjylwf.js";import{u as K}from"./useNotifications-C15CMF32.js";import{u as G}from"./authStore-BiRtblIW.js";import{B as H}from"./Button-ByZOtwGJ.js";import{l as $}from"./logo-sena-BV4FM39N.js";import"./QItemLabel-BiKvV_tR.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";const J={class:"header-content"},W=["src"],X={class:"flex flex-center content-top content-responsive"},Y={class:"column items-center",style:{width:"100%","margin-bottom":"1rem"}},ee=["src"],oe={class:"row items-center q-mb-sm"},te={class:"row justify-center",style:{width:"100%","padding-top":"32px"}},be={__name:"Login",setup(re){const v=w(),i=p(!1),d=p(!1),n=p(null),u=K(),D=G();function S(o){const e=o?.response?.data;if(!e&&typeof o=="string")return o;if(!e&&o?.message)return o.message;if(!e)return o?.message||"Error de autenticación. Verifica tus credenciales.";if(e?.message)return e.message;if(e?.msg)return e.msg;if(e?.errors){if(Array.isArray(e.errors)&&e.errors.length>0)return e.errors[0]||e.errors.join(", ");if(typeof e.errors=="string")return e.errors}if(e?.error){if(typeof e.error=="string")return e.error;if(typeof e.error=="object"&&e.error.message)return e.error.message}return o?.message||"Error de autenticación. Verifica tus credenciales."}const T=[{label:"Administrador",value:"ADMINISTRADOR"},{label:"Instructor",value:"INSTRUCTOR"},{label:"Aprendiz",value:"APRENDIZ"}],N=[{label:"Cédula de Ciudadanía",value:"CC"},{label:"Tarjeta de Identidad",value:"TI"},{label:"Cédula de Extranjería",value:"CE"},{label:"PEP",value:"PEP"},{label:"Permiso por Protección Temporal",value:"PPT"}],r=p({tipoDocumento:"",documento:"",correo:"",contrasena:""});function O(){v.push("/CambiarContrasena")}function f(o){(o.key===" "||o.code==="Space")&&o.preventDefault()}y(()=>r.value.correo,o=>{o&&o.includes(" ")&&(r.value.correo=o.replace(/\s/g,""))}),y(()=>r.value.documento,o=>{o&&o.includes(" ")&&(r.value.documento=o.replace(/\s/g,""))}),y(()=>r.value.contrasena,o=>{o&&o.includes(" ")&&(r.value.contrasena=o.replace(/\s/g,""))});const k=async()=>{i.value=!0;try{let o,e,t;switch(n.value){case"ADMINISTRADOR":e="/users/login",t={email:r.value.correo,password:r.value.contrasena};break;case"INSTRUCTOR":e="/instructors/login",t={tpDocument:r.value.tipoDocumento,document:r.value.documento,password:r.value.contrasena};break;case"APRENDIZ":e="/apprentices/login",t={tpDocument:r.value.tipoDocumento,document:r.value.documento,password:r.value.contrasena};break;default:u.error("Por favor seleccione un rol válido"),i.value=!1;return}try{console.log("Intentando login con:",{endpoint:e,payload:t}),o=await Z(e,t),console.log("Respuesta del servidor:",o)}catch(E){console.error("Error en la petición:",E);const h=S(E);u.error(h),i.value=!1;return}const c=o?.token||o?.data?.token,g=o?.user||o?.instructor||o?.apprentice||o?.data?.user||o?.data?.instructor||o?.data?.apprentice;if(c&&g){switch(D.setAuth(c,g),localStorage.setItem("auth",JSON.stringify({token:c,user:g})),localStorage.setItem("authToken",c),localStorage.setItem("userRole",n.value.toLowerCase()),n.value){case"ADMINISTRADOR":case"INSTRUCTOR":v.push("/app/inicio");break;case"APRENDIZ":v.push("/app/aprendiz/inicio");break}u.success(o.msg||o.message||"Inicio de sesión exitoso")}else console.error("Respuesta inválida del servidor:",o),u.error("Respuesta del servidor inválida. Token o usuario no encontrado.")}catch(o){console.error("Error general en onSubmit:",o),u.error("Error inesperado en el sistema")}finally{i.value=!1}};return(o,e)=>(m(),b(_,{view:"hHh lpR fFf"},{default:s(()=>[l(z,{elevated:"",class:"text-white header-login"},{default:s(()=>[a("div",J,[l(P,{class:"header-logo"},{default:s(()=>[a("img",{src:I(F),class:"header-logo-img"},null,8,W)]),_:1}),e[6]||(e[6]=a("span",{class:"header-title"},"REPFORA EP",-1))])]),_:1}),l(B,{class:"page-container"},{default:s(()=>[a("div",X,[l(Q,{class:"q-pa-md login-card"},{default:s(()=>[a("div",Y,[a("img",{src:I($),alt:"Logo SENA",style:{width:"80px",height:"auto","margin-bottom":"12px"}},null,8,ee),e[7]||(e[7]=a("div",{class:"text-h5 text-bold text-center",style:{color:"var(--color-text-primary)"}},"INGRESO A REPFORA EP",-1))]),l(C,{filled:"",modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),options:T,"option-label":"label","option-value":"value","emit-value":"",label:"SELECCIONA TU ROL",class:"q-mb-md rounded-select",style:{width:"100%","max-width":"500px","font-size":"1.1rem"}},{prepend:s(()=>[...e[8]||(e[8]=[a("span",{class:"material-symbols-outlined",style:{"font-size":"28px",color:"var(--color-text-light)"}}," identity_platform ",-1)])]),_:1},8,["modelValue"]),n.value?(m(),b(j,{key:0,onSubmit:k,class:"form-container"},{default:s(()=>[n.value==="ADMINISTRADOR"?(m(),b(x,{key:0,filled:"",modelValue:r.value.correo,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.correo=t),label:"CORREO",type:"text",class:"rounded-select",rules:[t=>!!t||"El correo es requerido",t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Formato de correo invalido, tucorreo@gmail.com"],onKeydown:f},{prepend:s(()=>[...e[9]||(e[9]=[a("span",{class:"material-symbols-outlined",style:{"font-size":"24px",color:"var(--color-text-light)"}},"mail",-1)])]),_:1},8,["modelValue","rules"])):R("",!0),n.value==="INSTRUCTOR"||n.value==="APRENDIZ"?(m(),V(U,{key:1},[l(C,{modelValue:r.value.tipoDocumento,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.tipoDocumento=t),options:N,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"TIPO DE DOCUMENTO",filled:"",class:"rounded-select",rules:[t=>!!t||"El tipo de documento es requerido"]},{prepend:s(()=>[...e[10]||(e[10]=[a("span",{class:"material-symbols-outlined",style:{"font-size":"24px",color:"var(--color-text-light)"}},"badge",-1)])]),_:1},8,["modelValue","rules"]),l(x,{filled:"",modelValue:r.value.documento,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.documento=t),label:"NÚMERO DE DOCUMENTO",type:"text",class:"rounded-select",rules:[t=>!!t||"El número de documento es requerido"],onKeydown:f},{prepend:s(()=>[...e[11]||(e[11]=[a("span",{class:"material-symbols-outlined",style:{"font-size":"24px",color:"var(--color-text-light)"}},"123",-1)])]),_:1},8,["modelValue","rules"])],64)):R("",!0),l(x,{filled:"",modelValue:r.value.contrasena,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.contrasena=t),label:"CONTRASEÑA",type:d.value?"text":"password",class:"rounded-select",rules:[t=>!!t||"La contraseña es requerida"],onKeydown:f},{prepend:s(()=>[...e[12]||(e[12]=[a("span",{class:"material-symbols-outlined",style:{"font-size":"24px",color:"var(--color-text-light)"}},"lock",-1)])]),append:s(()=>[l(A,{name:d.value?"visibility":"visibility_off",class:"cursor-pointer",onClick:e[4]||(e[4]=t=>d.value=!d.value)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),a("div",oe,[l(A,{name:"vpn_key",size:"20px",class:"q-mr-xs"}),a("a",{onClick:O,class:"text-caption text-grey-7 cursor-pointer"},"Recuperar contraseña")]),a("div",te,[l(H,{label:"INGRESAR",type:"submit",loading:i.value,customClass:"wide-btn"},null,8,["loading"])])]),_:1})):R("",!0)]),_:1})])]),_:1}),l(M,{reveal:"",class:"bg-grey-5 text-black"},{default:s(()=>[l(q,null,{default:s(()=>[l(L,{class:"text-center"},{default:s(()=>[...e[13]||(e[13]=[a("div",{style:{"font-size":"0.9rem","font-weight":"500","letter-spacing":"0.5px"}}," REPFORA - Sena 2025 © Todos los derechos reservados ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{be as default};
