import{_ as se,r as q,a5 as oe,c as B,a as l,o as m,d as t,b as s,f as ie,s as le,i as ne,e as i,j as u,af as U,l as y,t as d,h as v,g as _}from"./index-D8k0Z2VW.js";import{Q as re}from"./QSelect-CCFBgF8v.js";import{Q as D}from"./QTd-Dz2_L_T4.js";import{Q as M}from"./QBadge-pToOuXWH.js";import{Q as de}from"./QPage-CDUm3vNP.js";import{u as ce}from"./useEntityManager-6kUzRwOq.js";import{u as ue}from"./useNotifications-C15CMF32.js";import{d as Q}from"./date-9AqZW7CU.js";import{B as me}from"./BackButton-OAicZK4q.js";import{P as ve}from"./PageHeader-BZtJRD6F.js";import{B as g}from"./Button-ByZOtwGJ.js";import{_ as F}from"./ButtonTableOptions-ivpzFDPv.js";import{T as pe}from"./Table-DrGgNztj.js";import{M as O}from"./Modal-CwwUMTwV.js";import"./QItemLabel-BiKvV_tR.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";import"./apiClient-Vvvjylwf.js";import"./QTooltip-BIz5X8HU.js";import"./QList-D6hH9GPe.js";import"./QLinearProgress-C9Sex94R.js";const fe={class:"q-mb-lg"},_e={class:"full-width row"},ge={class:"col-12"},be={class:"filters-wrapper flex items-center justify-between q-my-lg"},he={class:"filters-left flex items-center bg-white"},we={class:"filter-item search"},Ee={class:"filter-item status"},ye={class:"flex items-center q-gutter-xs"},De={class:"flex items-center q-gutter-xs"},xe={class:"q-pa-md flex flex-center column text-grey full-width"},Ve={class:"text-h6 flex items-center"},Ae={key:0,class:"modal-content-grid"},Pe={class:"modal-column"},ke={class:"data-grid"},Ce={class:"data-row"},Ne={class:"data-value"},Re={class:"data-row"},ze={class:"data-value"},Ie={class:"data-row"},Te={class:"data-value"},qe={class:"data-row"},Be={class:"data-value"},Ue={class:"modal-column"},Me={class:"data-grid"},Qe={class:"data-row"},Fe={class:"data-value"},Oe={key:0,class:"data-row"},je={class:"data-value"},Se={key:1,class:"data-row"},Ge={class:"data-value"},Je={class:"data-row"},Ye={class:"data-value"},$e={key:0,class:"observations-section"},We={class:"observations-content"},He={class:"action-buttons-footer"},Le={class:"text-h6 flex items-center"},Ke={class:"document-viewer"},Xe={key:0,class:"document-container"},Ze={key:0,class:"image-preview"},et=["src"],tt={key:1,class:"pdf-preview"},at=["src"],st={key:2,class:"file-info"},ot={key:1,class:"no-document"},it={class:"row justify-between full-width"},lt={__name:"document-validation",setup(nt){const n={PENDING:0,APPROVED:1,REJECTED:2,IN_REVIEW:3},j=()=>({_id:"",apprentice:"",time:"",date:"",status:n.PENDING,documentUrl:"",observations:"",submittedAt:"",validatedAt:"",validatedBy:""}),S={list:"/validations/myValidations",update:"/validations/validate"},G={listError:"Error al cargar tus validaciones",noData:"No tienes validaciones registradas",updateSuccess:"Validación actualizada correctamente",updateError:"Error al actualizar la validación"},{loadingTable:V,rows:p,showDetailDialog:b,selectedEntity:J,filtersData:h,pagination:w,handlePaginationRequest:Y,openDetailsDialog:$}=ce({entityName:"validation",entityNamePlural:"validations",getDefaultFormData:j,endpoints:S,messages:G}),W=p,r=J,H=$,f=ue(),E=q(!1),c=q(null),L=[{label:"Todos los estados",value:""},{label:"Aprobado",value:n.APPROVED},{label:"Rechazado",value:n.REJECTED}],K=[{name:"apprentice",align:"left",label:"Aprendiz",field:"apprentice",sortable:!0},{name:"date",align:"center",label:"Fecha que llegó el documento",field:"date",sortable:!0},{name:"time",align:"center",label:"Hora",field:"time",sortable:!0},{name:"status",align:"center",label:"Estado",field:"status"},{name:"options",align:"center",label:"Opciones"}];function A(a){switch(a){case n.PENDING:return"Pendiente";case n.IN_REVIEW:return"En Revisión";case n.APPROVED:return"Aprobado";case n.REJECTED:return"Rechazado";default:return"Desconocido"}}function P(a){switch(a){case n.PENDING:return"orange";case n.IN_REVIEW:return"info";case n.APPROVED:return"positive";case n.REJECTED:return"negative";default:return"grey"}}function k(a){switch(a){case n.PENDING:return"schedule";case n.IN_REVIEW:return"visibility";case n.APPROVED:return"check_circle";case n.REJECTED:return"cancel";default:return"help"}}function C(a){return a||"-"}function N(a){if(!a)return"-";try{return Q.formatDate(a,"DD/MM/YYYY")}catch{return a}}function R(a){if(!a)return"-";try{return Q.formatDate(a,"DD/MM/YYYY HH:mm")}catch{return a}}function X(a){return a?[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(o=>a.toLowerCase().endsWith(o)):!1}function Z(a){return a?a.toLowerCase().endsWith(".pdf"):!1}function z(a){c.value=a,E.value=!0}function ee(){E.value=!1,c.value=null}async function I(a){if(r.value)try{const e=p.value.findIndex(x=>x._id===r.value._id);e!==-1&&(p.value[e]={...p.value[e],status:a,validatedAt:new Date().toISOString(),validatedBy:"Administrador"}),b.value=!1;const o=a===n.APPROVED?"aprobado":"rechazado";f.showSuccess(`Documento ${o} correctamente`)}catch{f.showError("Error al validar el documento")}}function te(){if(!c.value?.documentUrl){f.showError("No hay documento disponible para descargar");return}try{const a=document.createElement("a");a.href=c.value.documentUrl,a.download=c.value.apprentice||"documento",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),f.showSuccess("Descarga iniciada")}catch{f.showError("Error al descargar el documento")}}const T=[{_id:"1",apprentice:"Juan Pérez García",time:"14:30",date:"2024-01-15",status:n.PENDING,documentUrl:"https://gc.scalahed.com/recursos/files/r161r/w25720w/Analisis%20de%20Estados%20Financieros_Bonson%20y%20Cortijo-15-28.pdf",submittedAt:"2024-01-15T10:30:00"},{_id:"2",apprentice:"María González López",time:"09:15",date:"2024-01-16",status:n.APPROVED,documentUrl:"https://gc.scalahed.com/recursos/files/r161r/w25720w/Analisis%20de%20Estados%20Financieros_Bonson%20y%20Cortijo-15-28.pdf",submittedAt:"2024-01-16T09:15:00",validatedAt:"2024-01-16T10:30:00",validatedBy:"Admin Principal"},{_id:"3",apprentice:"Carlos Rodríguez Martínez",time:"16:45",date:"2024-01-17",status:n.REJECTED,documentUrl:"https://gc.scalahed.com/recursos/files/r161r/w25720w/Analisis%20de%20Estados%20Financieros_Bonson%20y%20Cortijo-15-28.pdf",submittedAt:"2024-01-17T16:45:00",validatedAt:"2024-01-17T17:00:00",validatedBy:"Admin Principal"}];function ae(){p.value=T,w.value.rowsNumber=T.length,V.value=!1}return oe(async()=>{ae()}),(a,e)=>(m(),B(de,{class:"q-pa-md validations-page"},{default:l(()=>[t("div",fe,[s(me)]),t("div",_e,[t("div",ge,[s(ie,{class:"shadow-1 hero-card q-mb-xl"},{default:l(()=>[s(le,null,{default:l(()=>[s(ve,{title:"Validaciones de Documentos"}),e[8]||(e[8]=t("p",{class:"text-body2 text-grey-7 text-center q-mt-sm"}," Visualiza el estado de validación de tus documentos por parte del administrador. ",-1))]),_:1})]),_:1}),t("div",be,[t("div",he,[t("div",we,[s(ne,{modelValue:i(h).search,"onUpdate:modelValue":e[0]||(e[0]=o=>i(h).search=o),outlined:"",dense:"",clearable:"",debounce:"600",placeholder:"Buscar por aprendiz..."},{prepend:l(()=>[s(u,{name:"search",color:"grey-7"})]),_:1},8,["modelValue"])]),t("div",Ee,[s(re,{modelValue:i(h).status,"onUpdate:modelValue":e[1]||(e[1]=o=>i(h).status=o),options:L,outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",label:"Filtrar por Estado"},{prepend:l(()=>[s(u,{name:"filter_list",color:"green-8"})]),_:1},8,["modelValue"])])])]),s(pe,{card:"",rows:i(W),columns:K,pagination:i(w),"onUpdate:pagination":e[2]||(e[2]=o=>U(w)?w.value=o:null),"loanding-table":i(V),"row-key":"_id",onRequest:i(Y)},{"body-cell-time":l(o=>[s(D,{props:o},{default:l(()=>[t("div",ye,[s(u,{name:"schedule",size:"18px",color:"grey-7"}),t("span",null,d(C(o.row.time)),1)])]),_:2},1032,["props"])]),"body-cell-date":l(o=>[s(D,{props:o},{default:l(()=>[t("div",De,[s(u,{name:"event",size:"18px",color:"grey-7"}),t("span",null,d(N(o.row.date)),1)])]),_:2},1032,["props"])]),"body-cell-status":l(o=>[s(D,{props:o},{default:l(()=>[s(M,{color:P(o.row.status),class:"text-uppercase status-badge"},{default:l(()=>[s(u,{name:k(o.row.status),size:"14px",class:"q-mr-xs"},null,8,["name"]),y(" "+d(A(o.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-options":l(o=>[s(D,{props:o,class:"text-center table-options"},{default:l(()=>[s(F,{icon:"description",color:"primary",tooltip:"Ver Documento",onClick:x=>z(o.row)},null,8,["onClick"]),s(F,{icon:"visibility",color:"grey",tooltip:"Ver Detalles",onClick:x=>i(H)(o.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":l(()=>[t("div",xe,[s(u,{name:"assignment_turned_in",size:"2.5em",color:"positive"}),e[9]||(e[9]=t("div",{class:"text-subtitle2 q-mt-sm"}," No tienes validaciones registradas ",-1))])]),_:1},8,["rows","pagination","loanding-table","onRequest"]),s(O,{modelValue:i(b),"onUpdate:modelValue":e[6]||(e[6]=o=>U(b)?b.value=o:null),variant:"view",width:"900px","max-width":"90vw"},{header:l(()=>[t("div",Ve,[s(u,{name:"assignment_turned_in",class:"q-mr-sm"}),y(" "+d(i(r)?.apprentice||"Validación"),1)])]),body:l(()=>[i(r)?(m(),v("div",Ae,[t("div",Pe,[e[14]||(e[14]=t("div",{class:"section-title"},"Información del Aprendiz",-1)),t("div",ke,[t("div",Ce,[e[10]||(e[10]=t("div",{class:"text-weight-bold"},"Aprendiz:",-1)),t("div",Ne,d(i(r)?.apprentice||"-"),1)]),t("div",Re,[e[11]||(e[11]=t("div",{class:"text-weight-bold"},"Fecha:",-1)),t("div",ze,d(N(i(r)?.date)),1)]),t("div",Ie,[e[12]||(e[12]=t("div",{class:"text-weight-bold"},"Hora:",-1)),t("div",Te,d(C(i(r)?.time)),1)]),t("div",qe,[e[13]||(e[13]=t("div",{class:"text-weight-bold"},"Fecha de envío:",-1)),t("div",Be,d(R(i(r)?.submittedAt)),1)])])]),t("div",Ue,[e[20]||(e[20]=t("div",{class:"section-title"},"Estado de Validación",-1)),t("div",Me,[t("div",Qe,[e[15]||(e[15]=t("div",{class:"text-weight-bold"},"Estado:",-1)),t("div",Fe,[s(M,{color:P(i(r)?.status),class:"status-badge-large"},{default:l(()=>[s(u,{name:k(i(r)?.status),size:"18px",class:"q-mr-xs"},null,8,["name"]),y(" "+d(A(i(r)?.status)),1)]),_:1},8,["color"])])]),i(r)?.validatedAt?(m(),v("div",Oe,[e[16]||(e[16]=t("div",{class:"text-weight-bold"},"Fecha de validación:",-1)),t("div",je,d(R(i(r)?.validatedAt)),1)])):_("",!0),i(r)?.validatedBy?(m(),v("div",Se,[e[17]||(e[17]=t("div",{class:"text-weight-bold"},"Validado por:",-1)),t("div",Ge,d(i(r)?.validatedBy),1)])):_("",!0),t("div",Je,[e[18]||(e[18]=t("div",{class:"text-weight-bold"},"Documento:",-1)),t("div",Ye,[s(g,{label:"Ver documento",icon:"description",flat:"",dense:"",color:"primary",onClick:e[3]||(e[3]=o=>z(i(r)))})])])]),i(r)?.observations?(m(),v("div",$e,[e[19]||(e[19]=t("div",{class:"section-title"},"Observaciones del Administrador",-1)),t("div",We,[s(u,{name:"comment",size:"20px",color:"grey-7",class:"q-mr-sm"}),t("span",null,d(i(r)?.observations),1)])])):_("",!0)])])):_("",!0)]),footer:l(()=>[t("div",He,[s(g,{label:"Rechazar","custom-class":"btn-reject",onClick:e[4]||(e[4]=o=>I(n.REJECTED))}),s(g,{label:"Aprobar","custom-class":"btn-approve",onClick:e[5]||(e[5]=o=>I(n.APPROVED))})])]),_:1},8,["modelValue"]),s(O,{modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=o=>E.value=o),variant:"view",width:"1000px","max-width":"95vw"},{header:l(()=>[t("div",Le,[s(u,{name:"description",class:"q-mr-sm"}),y(" Documento - "+d(c.value?.apprentice||"Validación"),1)])]),body:l(()=>[t("div",Ke,[c.value?.documentUrl?(m(),v("div",Xe,[X(c.value?.documentUrl)?(m(),v("div",Ze,[t("img",{src:c.value.documentUrl,alt:"Documento"},null,8,et)])):Z(c.value?.documentUrl)?(m(),v("div",tt,[t("iframe",{src:c.value.documentUrl,width:"100%",height:"600px",frameborder:"0"},null,8,at)])):(m(),v("div",st,[s(u,{name:"insert_drive_file",size:"64px",color:"grey-6"}),e[21]||(e[21]=t("div",{class:"text-h6 q-mt-md"},"Archivo no previsualizable",-1)),e[22]||(e[22]=t("div",{class:"text-caption text-grey-7"}," Descarga el archivo para verlo ",-1))]))])):(m(),v("div",ot,[s(u,{name:"cloud_off",size:"64px",color:"grey-5"}),e[23]||(e[23]=t("div",{class:"text-subtitle1 q-mt-md text-grey-7"}," No hay documento disponible ",-1))]))])]),footer:l(()=>[t("div",it,[s(g,{label:"Cerrar","custom-class":"boton-cerrar",onClick:ee}),c.value?.documentUrl?(m(),B(g,{key:0,label:"Descargar","custom-class":"gradient-btn",onClick:te})):_("",!0)])]),_:1},8,["modelValue"])])])]),_:1}))}},Nt=se(lt,[["__scopeId","data-v-f66f3950"]]);export{Nt as default};
