import{Q as ee}from"./QBadge-pToOuXWH.js";import{Q as M}from"./QTd-Dz2_L_T4.js";import{Q as te}from"./QSelect-CCFBgF8v.js";import{_ as le,r as u,m as oe,a5 as ae,n as se,w as re,h as z,b as s,d as o,a as n,e as ie,o as B,l as ne,t as c,g as de,ae as ue,i as p}from"./index-D8k0Z2VW.js";import{Q as me}from"./QForm-BHoNUr4c.js";import{g as ce,a as Q}from"./apiClient-Vvvjylwf.js";import{u as ve}from"./useNotifications-C15CMF32.js";import{B as pe}from"./BackButton-OAicZK4q.js";import{B as E}from"./Button-ByZOtwGJ.js";import{T as fe}from"./Table-DrGgNztj.js";import{M as O}from"./Modal-CwwUMTwV.js";import{P as be}from"./PageHeader-BZtJRD6F.js";import{_}from"./ButtonTableOptions-ivpzFDPv.js";import"./QItemLabel-BiKvV_tR.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";import"./QList-D6hH9GPe.js";import"./QLinearProgress-C9Sex94R.js";import"./QTooltip-BIz5X8HU.js";const ge={class:"q-pa-md"},Ne={class:"container"},ye={key:0,class:"row q-col-gutter-lg"},Ve={class:"col-12 col-md-6"},we={class:"data-grid"},Ae={class:"data-row"},he={class:"data-value"},Ee={class:"data-row"},Te={class:"data-value"},Ce={class:"data-row"},Ie={class:"data-value"},xe={class:"data-row"},_e={class:"data-value"},ke={class:"col-12 col-md-6"},Pe={class:"data-grid"},qe={class:"data-row"},De={class:"data-value"},$e={class:"data-row"},Se={class:"data-value"},Re={class:"data-row"},Ue={class:"data-value"},Me={class:"row q-col-gutter-lg"},ze={class:"col-12 col-md-6"},Be={class:"col-12 col-md-6"},Qe={__name:"Apprentices",setup(Oe){const k=se(),v=ve(),f={ACTIVE:0,INACTIVE:1},j=[{label:"Cédula de Ciudadanía",value:"CC"},{label:"Tarjeta de Identidad",value:"TI"},{label:"Cédula de Extranjería",value:"CE"},{label:"Pasaporte",value:"PP"}],m=t=>t&&t.length>0||"Este campo es requerido",P=t=>/^\d+$/.test(t)||"Solo se permiten números",q=t=>/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(t)||"Solo se permiten letras",D=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Ingrese un email válido",L=t=>/^\d{7,15}$/.test(t)||"Ingrese un teléfono válido (7-15 dígitos)",b=t=>!/\s/.test(t)||"No se permiten espacios",T=t=>e=>e&&e.length>=t||`Mínimo ${t} caracteres`,g=t=>e=>e&&e.length<=t||`Máximo ${t} caracteres`,y=u([]),C=u(!1),I=u(!1),d=u(null),x=u(null),V=u(!1),N=u(!1),a=u({_id:"",documentNumber:"",documentType:"",firstName:"",lastName:"",emailPersonal:"",emailInstitutional:"",phone:"",recordNumber:""});u(""),u("all");const w=u(""),A=oe(()=>{const t={};return w.value&&(t.recordNumber=w.value),t}),F=y,G=[{name:"documentNumber",label:"Documento",field:"documentNumber",sortable:!0,align:"left"},{name:"firstName",label:"Nombres",field:"firstName",sortable:!0,align:"left"},{name:"lastName",label:"Apellidos",field:"lastName",sortable:!0,align:"left"},{name:"phone",label:"Teléfono",field:"phone",sortable:!0,align:"left"},{name:"status",label:"Estado",field:"status",sortable:!0,align:"center"},{name:"opciones",label:"Opciones",align:"center"}],$=t=>t?.email?.personal||"",S=t=>t?.email?.institutional||"",H=t=>{const e=t?.recordNumber;return Array.isArray(e)&&e.length>0?e[0]?.fiche?.number?e[0].fiche.number:e[0]?.fiche?._id?e[0].fiche.number||e[0].fiche._id:e[0]?.fiche||e[0]||"":""},h=async(t={})=>{C.value=!0;try{const e=new URLSearchParams(t).toString(),l=e?`/apprentices/listApprentice?${e}`:"/apprentices/listApprentice",r=await ce(l);let i=r?.Apprentice||r?.apprentices||r?.data||r?.msg||[];if(!Array.isArray(i)&&typeof i=="object"){const X=Object.keys(i);for(const U of X)if(Array.isArray(i[U])){i=i[U];break}}y.value=Array.isArray(i)?i:[],y.value.length===0&&Object.keys(t).length===0&&v.info("No hay aprendices registrados")}catch(e){y.value=[],v.error(e.response?.data?.message||e.response?.data?.msg||"Error al cargar aprendices")}finally{C.value=!1}},Y=t=>t===f.ACTIVE?"Activo":"Inactivo",Z=t=>t===f.ACTIVE?"positive":"negative",J=t=>{d.value=t,V.value=!0},K=t=>{const e=H(t);console.log("Apprentice data:",t),console.log("Record number extracted:",e),a.value={_id:t._id||"",documentNumber:t.documentNumber||"",documentType:t.documentType||"",firstName:t.firstName||"",lastName:t.lastName||"",emailPersonal:$(t),emailInstitutional:S(t),phone:t.phone||"",recordNumber:e},N.value=!0},R=async()=>{if(!await x.value.validate()){v.error("Por favor complete todos los campos correctamente");return}I.value=!0;const e={documentNumber:a.value.documentNumber,documentType:a.value.documentType,firstName:a.value.firstName,lastName:a.value.lastName,email:{personal:a.value.emailPersonal,institutional:a.value.emailInstitutional},phone:a.value.phone,recordNumber:[a.value.recordNumber]};try{await Q(`/apprentices/updateEntireApprentice/${a.value._id}`,e),v.success("Aprendiz actualizado exitosamente"),N.value=!1,x.value?.resetValidation(),await h(A.value)}catch(l){const r=l.response?.data,i=Array.isArray(r?.errors)?r.errors.join(`
`):r?.message||r?.msg||r?.error||"Error al actualizar el aprendiz";v.error(i)}finally{I.value=!1}},W=async t=>{const e=t.status===f.ACTIVE,l=e?"desactivar":"activar";try{const r=e?"disableApprentice":"activateApprentice";console.log(`Attempting to ${l} apprentice:`,t._id);const i=await Q(`/apprentices/${r}/${t._id}`);console.log("Toggle status response:",i),v.success(`Aprendiz ${e?"desactivado":"activado"} exitosamente`),await h(A.value)}catch(r){console.error("Error toggling status:",r);const i=r.response?.data?.message||r.response?.data?.msg||r.response?.data?.error||`Error al ${l} el aprendiz`;v.error(i)}};return ae(()=>{w.value=k.query.recordNumber||"",h(A.value)}),re(()=>k.query.recordNumber,t=>{w.value=t||"",h(t?A.value:{})}),(t,e)=>(B(),z("div",ge,[s(pe),s(be,{title:"APRENDICES",description:"Listado y gestión de aprendices inscritos."}),o("div",Ne,[s(fe,{card:"",rows:ie(F),columns:G,"row-key":"_id",loading:C.value,"rows-per-page-options":[10,20,50]},{"body-cell-status":n(l=>[s(M,{props:l},{default:n(()=>[s(ee,{color:Z(l.row.status)},{default:n(()=>[ne(c(Y(l.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-opciones":n(l=>[s(M,{props:l},{default:n(()=>[s(_,{icon:"visibility",tooltip:"Ver detalles",color:"primary",onClick:r=>J(l.row)},null,8,["onClick"]),s(_,{icon:"edit",tooltip:"Editar",color:"primary",onClick:r=>K(l.row)},null,8,["onClick"]),s(_,{color:l.row.status===f.ACTIVE?"positive":"negative",icon:l.row.status===f.ACTIVE?"check":"close",tooltip:l.row.status===f.ACTIVE?"Desactivar":"Activar",onClick:r=>W(l.row)},null,8,["color","icon","tooltip","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),s(O,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value=l),width:"1200px","max-width":"98vw"},{header:n(()=>[...e[12]||(e[12]=[o("div",{class:"modal-header-content"},[o("div",{class:"text-h6"},"Detalles del Aprendiz")],-1)])]),body:n(()=>[d.value?(B(),z("div",ye,[o("div",Ve,[e[17]||(e[17]=o("div",{class:"text-h6 q-mb-md section-title"},"Datos Personales",-1)),o("div",we,[o("div",Ae,[e[13]||(e[13]=o("div",{class:"text-weight-bold"},"Tipo de Documento:",-1)),o("div",he,c(d.value.documentType||"-"),1)]),o("div",Ee,[e[14]||(e[14]=o("div",{class:"text-weight-bold"},"Número de Documento:",-1)),o("div",Te,c(d.value.documentNumber||"-"),1)]),o("div",Ce,[e[15]||(e[15]=o("div",{class:"text-weight-bold"},"Nombres:",-1)),o("div",Ie,c(d.value.firstName||"-"),1)]),o("div",xe,[e[16]||(e[16]=o("div",{class:"text-weight-bold"},"Apellidos:",-1)),o("div",_e,c(d.value.lastName||"-"),1)])])]),o("div",ke,[e[21]||(e[21]=o("div",{class:"text-h6 q-mb-md section-title"},"Datos de Contacto",-1)),o("div",Pe,[o("div",qe,[e[18]||(e[18]=o("div",{class:"text-weight-bold"},"Teléfono:",-1)),o("div",De,c(d.value.phone||"-"),1)]),o("div",$e,[e[19]||(e[19]=o("div",{class:"text-weight-bold"},"Email Personal:",-1)),o("div",Se,c($(d.value)||"-"),1)]),o("div",Re,[e[20]||(e[20]=o("div",{class:"text-weight-bold"},"Email Institucional:",-1)),o("div",Ue,c(S(d.value)||"-"),1)])])])])):de("",!0)]),footer:n(()=>[s(E,{label:"Ver proceso EP","custom-class":"boton",to:`/admin/ep-processes?apprenticeId=${d.value?d.value._id:""}`},null,8,["to"]),s(E,{label:"Cerrar","custom-class":"boton-cerrar",onClick:e[0]||(e[0]=l=>V.value=!1)})]),_:1},8,["modelValue"]),s(O,{modelValue:N.value,"onUpdate:modelValue":e[11]||(e[11]=l=>N.value=l),width:"900px","max-width":"98vw"},{header:n(()=>[...e[22]||(e[22]=[o("div",{class:"modal-header-content"},[o("div",{class:"text-h6"},"Editar Aprendiz")],-1)])]),body:n(()=>[s(me,{ref_key:"formRef",ref:x,onSubmit:ue(R,["prevent"]),class:"q-gutter-md"},{default:n(()=>[o("div",Me,[o("div",ze,[e[23]||(e[23]=o("div",{class:"text-h6 q-mb-md section-title"},"Datos de Identificación",-1)),s(te,{filled:"",modelValue:a.value.documentType,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.documentType=l),options:j,label:"Tipo de Documento *",rules:[m],disable:"","emit-value":"","map-options":""},null,8,["modelValue","rules"]),s(p,{filled:"",modelValue:a.value.documentNumber,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.documentNumber=l),label:"Número de Documento *",rules:[m,P,T(7),g(20),b],disable:""},null,8,["modelValue","rules"]),e[24]||(e[24]=o("div",{class:"text-h6 q-mb-md q-mt-lg section-title"},"Nombres",-1)),s(p,{filled:"",modelValue:a.value.firstName,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.firstName=l),label:"Nombres *",rules:[m,T(2),g(50),q]},null,8,["modelValue","rules"]),s(p,{filled:"",modelValue:a.value.lastName,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.lastName=l),label:"Apellidos *",rules:[m,T(2),g(50),q]},null,8,["modelValue","rules"])]),o("div",Be,[e[25]||(e[25]=o("div",{class:"text-h6 q-mb-md section-title"},"Datos de Contacto",-1)),s(p,{filled:"",modelValue:a.value.phone,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.phone=l),label:"Teléfono *",type:"tel",rules:[m,L,b]},null,8,["modelValue","rules"]),s(p,{filled:"",modelValue:a.value.emailPersonal,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.emailPersonal=l),label:"Email Personal *",type:"email",rules:[m,D,g(100),b]},null,8,["modelValue","rules"]),e[26]||(e[26]=o("div",{class:"text-h6 q-mb-md q-mt-lg section-title"},"Email Institucional",-1)),s(p,{filled:"",modelValue:a.value.emailInstitutional,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.emailInstitutional=l),label:"Email Institucional *",type:"email",rules:[m,D,g(100),b],hint:"Debe terminar en @sena.edu.co"},null,8,["modelValue","rules"]),e[27]||(e[27]=o("div",{class:"text-h6 q-mb-md q-mt-lg section-title"},"Número de Ficha",-1)),s(p,{filled:"",modelValue:a.value.recordNumber,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.recordNumber=l),label:"Número de Ficha *",rules:[m,P,b],hint:"Número de ficha del aprendiz"},null,8,["modelValue","rules"])])])]),_:1},512)]),footer:n(()=>[s(E,{label:"Cancelar","custom-class":"boton-cerrar",onClick:e[10]||(e[10]=l=>N.value=!1)}),s(E,{label:"Guardar",onClick:R,loading:I.value},null,8,["loading"])]),_:1},8,["modelValue"])]))}},dt=le(Qe,[["__scopeId","data-v-a7556b4f"]]);export{dt as default};
