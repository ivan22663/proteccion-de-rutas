import{_ as X,r as n,m as A,c as Y,a as o,o as c,b as s,d as e,h as v,g as R,f as m,s as g,j as x,t as B,ad as tt,q as et}from"./index-D8k0Z2VW.js";import{Q as at,C as z}from"./auto-BTcMSK3N.js";import{Q as st}from"./QPage-CDUm3vNP.js";import{g as k}from"./apiClient-Vvvjylwf.js";import{u as rt}from"./useNotifications-C15CMF32.js";import{B as ot}from"./BackButton-OAicZK4q.js";import{B as lt}from"./Button-ByZOtwGJ.js";import{P as nt}from"./PageHeader-BZtJRD6F.js";const it={class:"full-width row"},dt={class:"col-12"},ct={class:"actions-wrapper flex justify-end q-my-lg"},ut={key:0,class:"loading-state"},pt={key:1,class:"row q-col-gutter-md"},vt={class:"col-12 col-md-6"},mt={class:"chart-container-medium"},gt={key:0,class:"empty-chart-message"},yt={class:"col-12 col-md-6"},ft={class:"chart-container-medium"},ht={key:0,class:"empty-chart-message"},_t={class:"col-12 col-md-6"},bt={class:"chart-container-medium"},xt={key:0,class:"empty-chart-message"},Ct={class:"col-12 col-md-6"},At={class:"chart-container-medium"},Rt={key:0,class:"q-pa-md"},kt={class:"text-center"},qt={class:"text-h3 text-primary"},wt={class:"row q-col-gutter-sm"},Pt={class:"col-6 text-center"},St={class:"text-h6"},zt={class:"col-6 text-center"},Et={class:"text-h6"},Tt={key:1,class:"empty-chart-message"},Nt={class:"col-12"},jt={class:"chart-container-large"},Dt={key:0,class:"empty-chart-message"},Mt={key:2,class:"empty-state"},Bt={__name:"PreRegistrationsStatistic",setup(Qt){const{error:H,success:J}=rt(),C=n(!1),E=n(!1),y=n(null),f=n(null),u=n(null),p=n(null),h=n(null),T=n(null),N=n(null),j=n(null),D=n(null);let q=null,w=null,P=null,S=null;const Q=A(()=>y.value&&Array.isArray(y.value)&&y.value.length>0),I=A(()=>f.value&&Array.isArray(f.value)&&f.value.length>0),V=A(()=>u.value?!!(typeof u.value=="object"&&!Array.isArray(u.value)||Array.isArray(u.value)&&u.value.length>0):!1),O=A(()=>p.value&&typeof p.value=="object"&&!Array.isArray(p.value)?p.value.avgProcessingTime!==void 0:!1),$=A(()=>h.value&&Array.isArray(h.value)&&h.value.length>0),Z=async()=>{C.value=!0,E.value=!1;try{const[r,t,a,b,i]=await Promise.all([k("/statistics/preregistrations/by-status").catch(l=>(console.error("Error en by-status:",l),null)),k("/statistics/preregistrations/by-modality").catch(l=>(console.error("Error en by-modality:",l),null)),k("/statistics/preregistrations/approval-rate").catch(l=>(console.error("Error en approval-rate:",l),null)),k("/statistics/preregistrations/processing-time").catch(l=>(console.error("Error en processing-time:",l),null)),k("/statistics/preregistrations/trend?months=12").catch(l=>(console.error("Error en trend:",l),null))]),d=l=>{if(!l)return null;const _=l.data||l;return Array.isArray(_)||typeof _=="object",_};y.value=d(r),f.value=d(t),u.value=d(a),p.value=d(b),h.value=d(i),E.value=!0,console.log("Estadísticas cargadas:",{byStatus:y.value,byModality:f.value,approvalRate:u.value,processingTime:p.value,trend:h.value}),J("Estadísticas cargadas correctamente"),await et(),L()}catch(r){console.error("Error general al cargar estadísticas:",r);const t=r?.response?.data?.msg||r?.message||"Error al cargar estadísticas";H(t)}finally{C.value=!1}},M=r=>r==null?"N/A":`${Math.round(r)} días`,F=()=>{q&&(q.destroy(),q=null),w&&(w.destroy(),w=null),P&&(P.destroy(),P=null),S&&(S.destroy(),S=null)},L=()=>{F(),setTimeout(()=>{Q.value&&T.value&&(console.log("Renderizando statusChart con datos:",y.value),U()),I.value&&N.value&&(console.log("Renderizando modalityChart con datos:",f.value),W()),V.value&&j.value&&(console.log("Renderizando approvalChart con datos:",u.value),G()),$.value&&D.value&&(console.log("Renderizando trendChart con datos:",h.value),K())},100)},U=()=>{const r=T.value.getContext("2d"),t=y.value;q=new z(r,{type:"doughnut",data:{labels:t.map(a=>typeof a._id=="object"&&a._id!==null?a._id.name||a._id.status||"Sin estado":a._id===null||a._id===void 0?"Sin estado":a._id),datasets:[{data:t.map(a=>a.count),backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(241, 196, 15, 0.8)","rgba(231, 76, 60, 0.8)","rgba(149, 165, 166, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},W=()=>{const r=N.value.getContext("2d"),t=f.value;w=new z(r,{type:"bar",data:{labels:t.map(a=>typeof a._id=="object"&&a._id!==null?a._id.name||a._id.modality||"Sin modalidad":a._id===null||a._id===void 0?"Sin modalidad":a._id),datasets:[{label:"Pre-Registros",data:t.map(a=>a.count),backgroundColor:"rgba(52, 152, 219, 0.7)",borderColor:"rgba(52, 152, 219, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}})},G=()=>{const r=j.value.getContext("2d"),t=u.value;let a=[],b=[];if(Array.isArray(t))a=t.map(i=>i._id||i.status||"Sin estado"),b=t.map(i=>i.count||i.value||0);else if(typeof t=="object"&&t!==null){const i=Object.keys(t);a=i.map(d=>({approved:"Aprobados",rejected:"Rechazados",pending:"Pendientes",approvalRate:"Tasa de Aprobación (%)",rejectionRate:"Tasa de Rechazo (%)"})[d]||d.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase())),b=i.map(d=>t[d]||0)}P=new z(r,{type:"doughnut",data:{labels:a,datasets:[{data:b,backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(231, 76, 60, 0.8)","rgba(241, 196, 15, 0.8)","rgba(52, 152, 219, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},K=()=>{const r=D.value.getContext("2d"),t=h.value;S=new z(r,{type:"line",data:{labels:t.map(a=>a._id&&a._id.year&&a._id.month?`${["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][a._id.month-1]} ${a._id.year}`:a._id||"Sin fecha"),datasets:[{label:"Pre-Registros",data:t.map(a=>a.count),borderColor:"rgba(52, 152, 219, 1)",backgroundColor:"rgba(52, 152, 219, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}},plugins:{legend:{display:!1}}}})};return(r,t)=>(c(),Y(st,{class:"q-pa-md preregistrations-statistics-page"},{default:o(()=>[s(ot,{class:"q-mb-lg"}),e("div",it,[e("div",dt,[s(m,{class:"shadow-1 hero-card q-mb-xl"},{default:o(()=>[s(g,null,{default:o(()=>[s(nt,{title:"Estadísticas de Pre-Registros",description:"Indicadores y análisis de pre-registros del sistema."})]),_:1})]),_:1}),e("div",ct,[s(lt,{label:"Cargar Estadísticas","custom-class":"gradient-btn",icon:"analytics",onClick:Z,loading:C.value},null,8,["loading"])]),C.value?(c(),v("div",ut,[s(m,{class:"shadow-1"},{default:o(()=>[s(g,{class:"text-center q-pa-xl"},{default:o(()=>[s(at,{size:"64px",color:"primary"}),t[0]||(t[0]=e("div",{class:"text-h6 q-mt-md text-grey-7"}," Cargando estadísticas de pre-registros... ",-1))]),_:1})]),_:1})])):E.value?(c(),v("div",pt,[e("div",vt,[s(m,{class:"shadow-1"},{default:o(()=>[s(g,null,{default:o(()=>[t[2]||(t[2]=e("div",{class:"text-h6 q-mb-md"},"Pre-Registros por Estado",-1)),e("div",mt,[e("canvas",{ref_key:"statusChart",ref:T},null,512),Q.value?R("",!0):(c(),v("div",gt,[s(x,{name:"pie_chart",size:"48px",color:"grey-4"}),t[1]||(t[1]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de pre-registros por estado ",-1))]))])]),_:1})]),_:1})]),e("div",yt,[s(m,{class:"shadow-1"},{default:o(()=>[s(g,null,{default:o(()=>[t[4]||(t[4]=e("div",{class:"text-h6 q-mb-md"},"Pre-Registros por Modalidad",-1)),e("div",ft,[e("canvas",{ref_key:"modalityChart",ref:N},null,512),I.value?R("",!0):(c(),v("div",ht,[s(x,{name:"donut_small",size:"48px",color:"grey-4"}),t[3]||(t[3]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de pre-registros por modalidad ",-1))]))])]),_:1})]),_:1})]),e("div",_t,[s(m,{class:"shadow-1"},{default:o(()=>[s(g,null,{default:o(()=>[t[6]||(t[6]=e("div",{class:"text-h6 q-mb-md"},"Tasa de Aprobación",-1)),e("div",bt,[e("canvas",{ref_key:"approvalChart",ref:j},null,512),V.value?R("",!0):(c(),v("div",xt,[s(x,{name:"donut_large",size:"48px",color:"grey-4"}),t[5]||(t[5]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de tasa de aprobación ",-1))]))])]),_:1})]),_:1})]),e("div",Ct,[s(m,{class:"shadow-1"},{default:o(()=>[s(g,null,{default:o(()=>[t[11]||(t[11]=e("div",{class:"text-h6 q-mb-md"},"Tiempo de Procesamiento",-1)),e("div",At,[O.value?(c(),v("div",Rt,[e("div",kt,[e("div",qt,B(M(p.value.avgProcessingTime)),1),t[7]||(t[7]=e("div",{class:"text-subtitle2 text-grey-7"},"Promedio de días",-1))]),s(tt,{class:"q-my-md"}),e("div",wt,[e("div",Pt,[e("div",St,B(M(p.value.minProcessingTime)),1),t[8]||(t[8]=e("div",{class:"text-caption text-grey-7"},"Mínimo",-1))]),e("div",zt,[e("div",Et,B(M(p.value.maxProcessingTime)),1),t[9]||(t[9]=e("div",{class:"text-caption text-grey-7"},"Máximo",-1))])])])):(c(),v("div",Tt,[s(x,{name:"schedule",size:"48px",color:"grey-4"}),t[10]||(t[10]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de tiempo de procesamiento ",-1))]))])]),_:1})]),_:1})]),e("div",Nt,[s(m,{class:"shadow-1"},{default:o(()=>[s(g,null,{default:o(()=>[t[13]||(t[13]=e("div",{class:"text-h6 q-mb-md"},"Tendencia de Pre-Registros (Últimos 12 meses)",-1)),e("div",jt,[e("canvas",{ref_key:"trendChart",ref:D},null,512),$.value?R("",!0):(c(),v("div",Dt,[s(x,{name:"trending_up",size:"48px",color:"grey-4"}),t[12]||(t[12]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de tendencia ",-1))]))])]),_:1})]),_:1})])])):C.value?R("",!0):(c(),v("div",Mt,[s(m,{class:"shadow-1"},{default:o(()=>[s(g,{class:"text-center q-pa-xl"},{default:o(()=>[s(x,{name:"folder",size:"64px",color:"grey-5"}),t[14]||(t[14]=e("div",{class:"text-h6 q-mt-md text-grey-7"}," No hay estadísticas disponibles ",-1)),t[15]||(t[15]=e("div",{class:"text-body2 text-grey-6 q-mt-sm"},' Presiona "Cargar Estadísticas" para visualizar los datos ',-1))]),_:1})]),_:1})]))])])]),_:1}))}},Lt=X(Bt,[["__scopeId","data-v-53b99213"]]);export{Lt as default};
