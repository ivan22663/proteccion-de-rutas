import{_ as ot,r as l,m as _,c as rt,a as r,o as d,b as e,d as a,h as c,g as b,f as u,s as p,j as v,t as V,ad as lt,q as nt}from"./index-D8k0Z2VW.js";import{Q as dt,C as j}from"./auto-BTcMSK3N.js";import{Q as it}from"./QPage-CDUm3vNP.js";import{g as h}from"./apiClient-Vvvjylwf.js";import{u as ct}from"./useNotifications-C15CMF32.js";import{B as ut}from"./BackButton-OAicZK4q.js";import{B as pt}from"./Button-ByZOtwGJ.js";import{P as yt}from"./PageHeader-BZtJRD6F.js";const mt={class:"full-width row"},vt={class:"col-12"},gt={class:"actions-wrapper flex justify-end q-my-lg"},ft={key:0,class:"loading-state"},_t={key:1,class:"row q-col-gutter-md"},bt={class:"col-12 col-md-6"},ht={class:"chart-container-medium"},xt={key:0,class:"empty-chart-message"},Ct={class:"col-12 col-md-6"},At={class:"chart-container-medium"},qt={key:0,class:"empty-chart-message"},kt={class:"col-12 col-md-6"},wt={class:"chart-container-medium"},jt={key:0,class:"empty-chart-message"},St={class:"col-12 col-md-6"},Dt={class:"chart-container-medium"},Et={key:0,class:"q-pa-md"},Pt={class:"text-center"},Rt={class:"text-h3 text-primary"},Nt={class:"row q-col-gutter-sm"},zt={class:"col-6 text-center"},Bt={class:"text-h6"},It={class:"col-6 text-center"},Tt={class:"text-h6"},Qt={key:1,class:"empty-chart-message"},Mt={class:"col-12 col-md-6"},Vt={class:"chart-container-medium"},Ht={key:0,class:"empty-chart-message"},Lt={class:"col-12 col-md-6"},Ot={class:"chart-container-medium"},Ut={key:0,class:"empty-chart-message"},Wt={key:2,class:"empty-state"},Zt={__name:"ProjectsStatistic",setup($t){const{error:Z,success:$}=ct(),x=l(!1),N=l(!1),C=l(null),A=l(null),q=l(null),y=l(null),m=l(null),k=l(null),z=l(null),B=l(null),I=l(null),T=l(null),Q=l(null);let S=null,D=null,E=null,P=null,R=null;const H=_(()=>C.value&&Array.isArray(C.value)&&C.value.length>0),L=_(()=>A.value&&Array.isArray(A.value)&&A.value.length>0),O=_(()=>q.value&&Array.isArray(q.value)&&q.value.length>0),F=_(()=>y.value&&typeof y.value=="object"&&!Array.isArray(y.value)?y.value.avgDuration!==void 0:!1),U=_(()=>m.value?!!(Array.isArray(m.value)&&m.value.length>0||typeof m.value=="object"&&!Array.isArray(m.value)):!1),W=_(()=>k.value&&Array.isArray(k.value)&&k.value.length>0),M=o=>o==null?"N/A":`${Math.round(o)} días`,g=o=>{if(!o)return null;const t=o.data||o;return Array.isArray(t)||typeof t=="object",t},G=async()=>{x.value=!0,N.value=!1;try{const[o,t,s,w,i,f]=await Promise.all([h("/statistics/projects/by-type").catch(n=>(console.error("Error en by-type:",n),null)),h("/statistics/projects/by-modality").catch(n=>(console.error("Error en by-modality:",n),null)),h("/statistics/projects/by-status").catch(n=>(console.error("Error en by-status:",n),null)),h("/statistics/projects/duration-analysis").catch(n=>(console.error("Error en duration-analysis:",n),null)),h("/statistics/projects/completion-rate").catch(n=>(console.error("Error en completion-rate:",n),null)),h("/statistics/projects/by-company").catch(n=>(console.error("Error en by-company:",n),null))]);C.value=g(o),A.value=g(t),q.value=g(s),y.value=g(w),m.value=g(i),k.value=g(f),N.value=!0,$("Estadísticas cargadas correctamente"),await nt(),K()}catch(o){console.error("Error general al cargar estadísticas:",o);const t=o?.response?.data?.msg||o?.message||"Error al cargar estadísticas";Z(t)}finally{x.value=!1}},J=()=>{S&&(S.destroy(),S=null),D&&(D.destroy(),D=null),E&&(E.destroy(),E=null),P&&(P.destroy(),P=null),R&&(R.destroy(),R=null)},K=()=>{J(),setTimeout(()=>{H.value&&z.value&&X(),L.value&&B.value&&Y(),O.value&&I.value&&tt(),U.value&&T.value&&at(),W.value&&Q.value&&st()},100)},X=()=>{const o=z.value.getContext("2d"),t=C.value;S=new j(o,{type:"doughnut",data:{labels:t.map(s=>typeof s._id=="object"&&s._id!==null?s._id.name||s._id.type||"Sin tipo":s._id===null||s._id===void 0?"Sin tipo":s._id),datasets:[{data:t.map(s=>s.count),backgroundColor:["rgba(52, 152, 219, 0.8)","rgba(46, 204, 113, 0.8)","rgba(155, 89, 182, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},Y=()=>{const o=B.value.getContext("2d"),t=A.value;D=new j(o,{type:"doughnut",data:{labels:t.map(s=>typeof s._id=="object"&&s._id!==null?s._id.name||s._id.modality||"Sin modalidad":s._id===null||s._id===void 0?"Sin modalidad":s._id),datasets:[{data:t.map(s=>s.count),backgroundColor:["rgba(241, 196, 15, 0.8)","rgba(52, 152, 219, 0.8)","rgba(46, 204, 113, 0.8)","rgba(155, 89, 182, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},tt=()=>{const o=I.value.getContext("2d"),t=q.value;E=new j(o,{type:"doughnut",data:{labels:t.map(s=>typeof s._id=="object"&&s._id!==null?s._id.name||s._id.status||"Sin estado":s._id===null||s._id===void 0?"Sin estado":s._id),datasets:[{data:t.map(s=>s.count),backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(52, 152, 219, 0.8)","rgba(231, 76, 60, 0.8)","rgba(149, 165, 166, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},at=()=>{const o=T.value.getContext("2d"),t=m.value;let s=[],w=[];if(Array.isArray(t))s=t.map(i=>i._id||i.status||"Sin estado"),w=t.map(i=>i.count||i.value||0);else if(typeof t=="object"&&t!==null){const i=Object.keys(t);s=i.map(f=>({completed:"Completados",active:"Activos",cancelled:"Cancelados",completionRate:"Tasa de Completitud (%)"})[f]||f.replace(/_/g," ").replace(/\b\w/g,et=>et.toUpperCase())),w=i.map(f=>t[f]||0)}P=new j(o,{type:"doughnut",data:{labels:s,datasets:[{data:w,backgroundColor:["rgba(46, 204, 113, 0.8)","rgba(52, 152, 219, 0.8)","rgba(231, 76, 60, 0.8)","rgba(241, 196, 15, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})},st=()=>{const o=Q.value.getContext("2d"),t=k.value;R=new j(o,{type:"bar",data:{labels:t.map(s=>typeof s._id=="object"&&s._id!==null?s._id.name||s._id.company||"Sin empresa":s._id===null||s._id===void 0?"Sin empresa":s._id),datasets:[{label:"Proyectos",data:t.map(s=>s.count),backgroundColor:"rgba(155, 89, 182, 0.7)",borderColor:"rgba(155, 89, 182, 1)",borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{beginAtZero:!0,ticks:{stepSize:1}}},plugins:{legend:{display:!1}}}})};return(o,t)=>(d(),rt(it,{class:"q-pa-md projects-statistics-page"},{default:r(()=>[e(ut,{class:"q-mb-lg"}),a("div",mt,[a("div",vt,[e(u,{class:"shadow-1 hero-card q-mb-xl"},{default:r(()=>[e(p,null,{default:r(()=>[e(yt,{title:"Estadísticas de Proyectos",description:"Indicadores y análisis de proyectos formativos del sistema."})]),_:1})]),_:1}),a("div",gt,[e(pt,{label:"Cargar Estadísticas","custom-class":"gradient-btn",icon:"analytics",onClick:G,loading:x.value},null,8,["loading"])]),x.value?(d(),c("div",ft,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,{class:"text-center q-pa-xl"},{default:r(()=>[e(dt,{size:"64px",color:"primary"}),t[0]||(t[0]=a("div",{class:"text-h6 q-mt-md text-grey-7"}," Cargando estadísticas de proyectos... ",-1))]),_:1})]),_:1})])):N.value?(d(),c("div",_t,[a("div",bt,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,null,{default:r(()=>[t[2]||(t[2]=a("div",{class:"text-h6 q-mb-md"},"Proyectos por Tipo",-1)),t[3]||(t[3]=a("div",{class:"text-caption text-grey-7 q-mb-md"}," Individuales vs grupales ",-1)),a("div",ht,[a("canvas",{ref_key:"typeChart",ref:z},null,512),H.value?b("",!0):(d(),c("div",xt,[e(v,{name:"pie_chart",size:"48px",color:"grey-4"}),t[1]||(t[1]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de proyectos por tipo ",-1))]))])]),_:1})]),_:1})]),a("div",Ct,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,null,{default:r(()=>[t[5]||(t[5]=a("div",{class:"text-h6 q-mb-md"},"Proyectos por Modalidad",-1)),a("div",At,[a("canvas",{ref_key:"modalityChart",ref:B},null,512),L.value?b("",!0):(d(),c("div",qt,[e(v,{name:"donut_small",size:"48px",color:"grey-4"}),t[4]||(t[4]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de proyectos por modalidad ",-1))]))])]),_:1})]),_:1})]),a("div",kt,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,null,{default:r(()=>[t[7]||(t[7]=a("div",{class:"text-h6 q-mb-md"},"Proyectos por Estado",-1)),t[8]||(t[8]=a("div",{class:"text-caption text-grey-7 q-mb-md"}," Activos, completados y cancelados ",-1)),a("div",wt,[a("canvas",{ref_key:"statusChart",ref:I},null,512),O.value?b("",!0):(d(),c("div",jt,[e(v,{name:"donut_large",size:"48px",color:"grey-4"}),t[6]||(t[6]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de proyectos por estado ",-1))]))])]),_:1})]),_:1})]),a("div",St,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,null,{default:r(()=>[t[13]||(t[13]=a("div",{class:"text-h6 q-mb-md"},"Análisis de Duración",-1)),t[14]||(t[14]=a("div",{class:"text-caption text-grey-7 q-mb-md"}," Duración promedio de proyectos ",-1)),a("div",Dt,[F.value?(d(),c("div",Et,[a("div",Pt,[a("div",Rt,V(M(y.value.avgDuration)),1),t[9]||(t[9]=a("div",{class:"text-subtitle2 text-grey-7"},"Promedio de días",-1))]),e(lt,{class:"q-my-md"}),a("div",Nt,[a("div",zt,[a("div",Bt,V(M(y.value.minDuration)),1),t[10]||(t[10]=a("div",{class:"text-caption text-grey-7"},"Mínimo",-1))]),a("div",It,[a("div",Tt,V(M(y.value.maxDuration)),1),t[11]||(t[11]=a("div",{class:"text-caption text-grey-7"},"Máximo",-1))])])])):(d(),c("div",Qt,[e(v,{name:"schedule",size:"48px",color:"grey-4"}),t[12]||(t[12]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de duración ",-1))]))])]),_:1})]),_:1})]),a("div",Mt,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,null,{default:r(()=>[t[16]||(t[16]=a("div",{class:"text-h6 q-mb-md"},"Tasa de Completitud",-1)),a("div",Vt,[a("canvas",{ref_key:"completionChart",ref:T},null,512),U.value?b("",!0):(d(),c("div",Ht,[e(v,{name:"donut_large",size:"48px",color:"grey-4"}),t[15]||(t[15]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de tasa de completitud ",-1))]))])]),_:1})]),_:1})]),a("div",Lt,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,null,{default:r(()=>[t[18]||(t[18]=a("div",{class:"text-h6 q-mb-md"},"Proyectos por Empresa (Top 20)",-1)),a("div",Ot,[a("canvas",{ref_key:"companyChart",ref:Q},null,512),W.value?b("",!0):(d(),c("div",Ut,[e(v,{name:"business",size:"48px",color:"grey-4"}),t[17]||(t[17]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"}," No hay datos de proyectos por empresa ",-1))]))])]),_:1})]),_:1})])])):x.value?b("",!0):(d(),c("div",Wt,[e(u,{class:"shadow-1"},{default:r(()=>[e(p,{class:"text-center q-pa-xl"},{default:r(()=>[e(v,{name:"folder",size:"64px",color:"grey-5"}),t[19]||(t[19]=a("div",{class:"text-h6 q-mt-md text-grey-7"}," No hay estadísticas disponibles ",-1)),t[20]||(t[20]=a("div",{class:"text-body2 text-grey-6 q-mt-sm"},' Presiona "Cargar Estadísticas" para visualizar los datos ',-1))]),_:1})]),_:1})]))])])]),_:1}))}},sa=ot(Zt,[["__scopeId","data-v-5838bae5"]]);export{sa as default};
