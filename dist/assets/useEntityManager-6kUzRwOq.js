import{p as M,a as q,g as W}from"./apiClient-Vvvjylwf.js";import{u as X}from"./useNotifications-C15CMF32.js";import{r}from"./index-D8k0Z2VW.js";function ra(p){if(!p.entityName||!p.entityNamePlural)throw new Error("entityName and entityNamePlural are required in configuration");if(!p.endpoints||!p.endpoints.list)throw new Error('At least the "list" endpoint is required in configuration');if(!p.getDefaultFormData||typeof p.getDefaultFormData!="function")throw new Error("getDefaultFormData function is required in configuration");const{entityName:v,entityNamePlural:S,getDefaultFormData:b,endpoints:s,messages:z={},buildPayload:A=null,processResponse:B=null,buildFilterParams:C=null}=p,u={...{listError:`Error al listar ${S}`,createSuccess:`${v.charAt(0).toUpperCase()+v.slice(1)} creada correctamente`,createError:`Error al crear ${v}`,updateSuccess:`${v.charAt(0).toUpperCase()+v.slice(1)} actualizada correctamente`,updateError:`Error al actualizar ${v}`,statusSuccess:"Estado actualizado correctamente",statusError:"No fue posible cambiar el estado",bulkUploadSuccess:"Carga masiva realizada correctamente",bulkUploadError:"Error al cargar el archivo",noData:`No hay ${S} registradas`},...z},{error:g,success:w}=X(),i=r(!1),U=r(!1),F=r([]),h=r(!1),$=r(!1),N=r(!1),D=r(!1),_=r(null),y=r(null),f=r(b()),l=r({search:"",status:""}),c=r({page:1,rowsPerPage:10,rowsNumber:0}),j=a=>{a?.pagination&&(c.value={page:a.pagination.page,rowsPerPage:a.pagination.rowsPerPage,rowsNumber:a.pagination.rowsNumber??c.value.rowsNumber},n())},E=()=>{c.value.page=1},O=()=>{E(),n()},R=()=>{E(),n()},x=()=>{E(),n()},I=()=>{l.value={search:"",status:""},E(),n()},T=()=>{D.value=!1,k(),h.value=!0},V=()=>{h.value=!1,P(!1)},G=a=>{_.value=a,$.value=!0},H=()=>{$.value=!1,_.value=null},J=()=>{y.value=null,N.value=!0},K=()=>{N.value=!1,y.value=null},P=a=>{a||(D.value=!1,k())},k=()=>{f.value=b()},L=a=>{h.value=!0,D.value=!0;const e=b();Object.keys(e).forEach(t=>{f.value[t]=a[t]??""})},Q=()=>{const a={},e=b();return Object.keys(e).forEach(t=>{if(t!=="_id"){const o=f.value[t];a[t]=typeof o=="string"?o.trim():o}}),a},n=async()=>{const{page:a,rowsPerPage:e}=c.value;U.value=!0;try{let t={page:a,limit:e};if(C)t=C(l.value,t);else{const d=l.value.search?.trim();d&&(t.search=d),l.value.status!==""&&l.value.status!==null&&(t.status=l.value.status),Object.keys(l.value).forEach(m=>{m!=="search"&&m!=="status"&&l.value[m]!==""&&l.value[m]!==null&&l.value[m]!==void 0&&(t[m]=l.value[m])})}const o=await W(s.list,{params:t});if(B){const d=B(o);F.value=d.data,c.value.rowsNumber=d.total}else{const d=o?.msg?.[S]??[];F.value=d,c.value.rowsNumber=o?.msg?.totalDocuments??d.length}}catch(t){const o=t?.response?.data?.msg||t?.message||u.listError;g(o),F.value=[],c.value.rowsNumber=0}finally{U.value=!1}};return{loading:i,loadingTable:U,rows:F,showAddDialog:h,showDetailDialog:$,showUploadDialog:N,isEditMode:D,selectedEntity:_,selectedFile:y,formData:f,filtersData:l,pagination:c,handlePaginationRequest:j,resetPaginationState:E,handleSearchChange:O,handleStatusChange:R,applyFilters:x,clearFilters:I,openFormDialog:T,closeFormDialog:V,openDetailsDialog:G,closeDetailsDialog:H,openBulkUploadDialog:J,closeBulkUploadDialog:K,handleAddDialogVisibility:P,resetForm:k,populateFormForEdit:L,fetchEntities:n,submitForm:async()=>{i.value=!0;const a=A?A(f.value):Q();if(!D.value){try{const e=await M(s.create,a);w(e?.msg||u.createSuccess),h.value=!1,P(!1),await n()}catch(e){g(e?.response?.data?.errors||e?.message||u.createError)}finally{i.value=!1}return}try{const e=typeof s.update=="function"?s.update(f.value._id):`${s.update}/${f.value._id}`,t=await q(e,a);w(t?.msg||u.updateSuccess),h.value=!1,P(!1),await n()}catch(e){g(e?.response?.data?.msg||e?.message||u.updateError)}finally{i.value=!1}},toggleStatus:async a=>{i.value=!0;try{const e=a.status==1;let t;e?t=typeof s.activate=="function"?s.activate(a._id):`${s.activate}/${a._id}`:t=typeof s.deactivate=="function"?s.deactivate(a._id):`${s.deactivate}/${a._id}`;const o=await q(t);w(o?.msg||u.statusSuccess),await n()}catch(e){g(e?.response?.data?.msg||e?.message||u.statusError)}finally{i.value=!1}},submitBulkUpload:async()=>{if(!s.bulkUpload){g("Bulk upload endpoint not configured");return}i.value=!0;try{const a=new FormData;a.append("file",y.value);const e=await M(s.bulkUpload,a);w(e?.msg||u.bulkUploadSuccess),N.value=!1,y.value=null,await n()}catch(a){g(a?.response?.data?.msg||a?.message||u.bulkUploadError)}finally{i.value=!1}}}}export{ra as u};
