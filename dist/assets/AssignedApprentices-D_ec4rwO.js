import{_ as Te,m as xe,r as B,a5 as Ce,w as se,c as De,a as d,n as Pe,u as Re,o as ae,b as o,d as a,i as A,e as i,j as T,l as M,t as b,af as Me,h as Se,g as ke,ae as Le}from"./index-D8k0Z2VW.js";import{Q as oe}from"./QSelect-CCFBgF8v.js";import{Q as le}from"./QBadge-pToOuXWH.js";import{Q as re}from"./QTd-Dz2_L_T4.js";import{Q as Ue}from"./QForm-BHoNUr4c.js";import{Q as je}from"./QPage-CDUm3vNP.js";import{g as O,a as ze}from"./apiClient-Vvvjylwf.js";import{u as qe}from"./useNotifications-C15CMF32.js";import{u as Be}from"./useEntityManager-6kUzRwOq.js";import{u as Oe}from"./authStore-BiRtblIW.js";import{B as $e}from"./BackButton-OAicZK4q.js";import{B as $}from"./Button-ByZOtwGJ.js";import{T as He}from"./Table-DrGgNztj.js";import{M as ie}from"./Modal-CwwUMTwV.js";import{P as Qe}from"./PageHeader-BZtJRD6F.js";import{_ as ne}from"./ButtonTableOptions-ivpzFDPv.js";import"./QItemLabel-BiKvV_tR.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";import"./QList-D6hH9GPe.js";import"./QLinearProgress-C9Sex94R.js";import"./QTooltip-BIz5X8HU.js";const Ge={class:"container"},Fe={class:"filters-wrapper q-mb-lg"},Xe={class:"filters-section"},Je={class:"row q-col-gutter-md"},Ye={class:"col-12 col-md-6"},Ze={class:"col-12 col-md-6"},Ke={class:"row q-gutter-xs justify-center"},We={class:"q-pa-md flex flex-center column text-grey full-width"},et={class:"modal-header"},tt={class:"text-h6 flex items-center"},st={key:0,class:"modal-content-grid"},at={class:"modal-column"},ot={class:"data-grid"},lt={class:"data-row"},rt={class:"data-value"},it={class:"data-row"},nt={class:"data-value"},dt={class:"data-row"},ut={class:"data-value"},ct={class:"data-row"},mt={class:"data-value"},pt={class:"data-row"},ft={class:"data-value"},vt={class:"modal-column"},gt={class:"data-grid"},bt={class:"data-row"},Nt={class:"data-value"},yt={class:"data-row"},At={class:"data-value"},_t={class:"data-row"},ht={class:"data-value"},Et={class:"data-row"},wt={class:"data-value"},It={class:"modal-header"},Vt={class:"text-h6 flex items-center"},Tt={class:"modal-content-grid"},xt={class:"modal-column"},Ct={class:"modal-column"},Dt={__name:"AssignedApprentices",setup(Pt){const x={ACTIVE:0,INACTIVE:1},H={ACTIVE:"Activo",INACTIVE:"Inactivo"},de=[{label:"Todos los estados",value:""},{label:"Activo",value:x.ACTIVE},{label:"Inactivo",value:x.INACTIVE}],h={MIN_NAME_LENGTH:3,MAX_NAME_LENGTH:100,PHONE_LENGTH:10,MAX_EMAIL_LENGTH:100},ue=[{label:"Cédula de Ciudadanía",value:"CC"},{label:"Tarjeta de Identidad",value:"TI"},{label:"Cédula de Extranjería",value:"CE"},{label:"Pasaporte",value:"PA"}],ce=Pe(),me=Re(),{success:pe,error:C,info:Q,warning:fe}=qe(),G=Oe(),D=xe(()=>{const t=G.user;if(t?._id)return t._id;if(t?.id)return t.id;if(t?.uid?._id)return t.uid._id;if(t?.uid?.id)return t.uid.id;try{const e=JSON.parse(localStorage.getItem("auth")||"{}"),s=G.token||e?.token;if(s){const l=s.split(".");if(l.length===3){const n=JSON.parse(atob(l[1]));return n?.uid?._id||n?.uid?.id||n?.uid}}}catch{}return null}),N=t=>!!t||"Este campo es requerido",F=t=>!t&&t!==0?!0:!isNaN(t)||"Debe ser un número",S=t=>e=>e?e.length>=t||`Debe tener al menos ${t} caracteres`:!0,E=t=>e=>e?e.length<=t||`No debe exceder ${t} caracteres`:!0,w=t=>{if(!t)return!0;let e=0;for(;e<t.length;){if(t[e]===" ")return"No debe contener espacios";e++}return!0},X=t=>t?/^[a-zA-ZÀ-ÿ\s]+$/.test(t)||"Solo debe contener letras y espacios":!0,ve=t=>t?/^3\d{9}$/.test(t)||"El teléfono debe tener 10 dígitos y comenzar con 3":!0,J=t=>t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Email inválido":!0,ge=()=>({_id:"",documentNumber:"",documentType:"",firstName:"",lastName:"",emailPersonal:"",emailInstitutional:"",phone:"",recordNumber:""}),Y={list:"/apprentices/listApprentice",update:t=>`/apprentices/updateEntireApprentice/${t}`},be={listError:"Error al cargar aprendices",updateSuccess:"Aprendiz actualizado exitosamente",updateError:"Error al actualizar el aprendiz",noData:"No hay aprendices registrados"},Ne=t=>{let e=t?.Apprentice||t?.apprentices||t?.data||t?.msg||[];if(!Array.isArray(e)&&typeof e=="object"){const l=Object.keys(e);for(const n of l)if(Array.isArray(e[n])){e=e[n];break}}const s=Array.isArray(e)?e:[];return{data:s,total:t?.total||t?.totalDocuments||t?.totalApprentices||s.length}},ye=(t,e)=>{const s={...e};return t.search?.trim()&&(s.search=t.search.trim()),t.status!==""&&t.status!==null&&t.status!==void 0&&(s.status=t.status),s},{loadingTable:k,loading:L,rows:P,showDetailDialog:U,selectedEntity:m,filtersData:p,pagination:I,handlePaginationRequest:Ae,resetPaginationState:Z,openDetailsDialog:_e,closeDetailsDialog:he,fetchEntities:Ee}=Be({entityName:"apprentice",entityNamePlural:"apprentices",getDefaultFormData:ge,endpoints:Y,messages:be,processResponse:Ne,buildFilterParams:ye}),j=B(null),V=B(!1),r=B({_id:"",documentNumber:"",documentType:"",firstName:"",lastName:"",emailPersonal:"",emailInstitutional:"",phone:"",recordNumber:""}),we=[{name:"documentNumber",label:"Documento",field:"documentNumber",sortable:!0,align:"left"},{name:"firstName",label:"Nombres",field:"firstName",sortable:!0,align:"left"},{name:"lastName",label:"Apellidos",field:"lastName",sortable:!0,align:"left"},{name:"phone",label:"Teléfono",field:"phone",sortable:!0,align:"left"},{name:"status",label:"Estado",field:"status",sortable:!0,align:"center"},{name:"opciones",label:"Opciones",align:"center"}],z=t=>t?.email?.personal||"",q=t=>t?.email?.institutional||"",K=t=>{const e=t?.recordNumber;return Array.isArray(e)&&e.length>0&&(e[0]?.fiche||e[0])||""},W=t=>t===x.ACTIVE?H.ACTIVE:H.INACTIVE,ee=t=>t===x.ACTIVE?"positive":"negative",R=async(t=null)=>{k.value=!0;try{let e=[];if(D.value)try{const l=await O("/projects/getProject"),n=l?.data||l?.msg||l||[];(Array.isArray(n)?n:[]).filter(v=>!v.instructors||!Array.isArray(v.instructors)?!1:v.instructors.some(c=>{const y=c.id||c._id||(typeof c=="string"?c:null);return y===D.value||y===String(D.value)})).forEach(v=>{v.apprentices&&Array.isArray(v.apprentices)&&v.apprentices.forEach(c=>{const y=c.id||c._id||(typeof c=="string"?c:null);y&&!e.includes(y)&&e.push(y)})})}catch(l){console.warn("Error al obtener proyectos del instructor:",l),fe("No se pudieron obtener los proyectos. Mostrando todos los aprendices.")}let s=[];if(e.length>0){const l=e.map(async f=>{try{const u=await O(`/apprentices/apprenticeById/${f}`);return u?.data||u?.msg||u}catch{return null}});if(s=(await Promise.all(l)).filter(f=>f!==null),s.length<e.length){const f=await O("/apprentices/listApprentice");let u=f?.Apprentice||f?.apprentices||f?.data||f?.msg||[];if(!Array.isArray(u)&&typeof u=="object"){const g=Object.keys(u);for(const _ of g)if(Array.isArray(u[_])){u=u[_];break}}const c=(Array.isArray(u)?u:[]).filter(g=>{const _=g._id||g.id;return e.includes(_)||e.includes(String(_))}),y=s.map(g=>g._id||g.id);c.forEach(g=>{const _=g._id||g.id;y.includes(_)||s.push(g)})}}else{await Ee(t);return}if(p.value.search&&e.length>0){const l=p.value.search.toLowerCase();s=s.filter(n=>{const f=`${n.firstName||""} ${n.lastName||""}`.toLowerCase(),u=(n.documentNumber||"").toString().toLowerCase(),v=(z(n)||"").toLowerCase(),c=(q(n)||"").toLowerCase();return f.includes(l)||u.includes(l)||v.includes(l)||c.includes(l)})}p.value.status!==""&&p.value.status!==null&&e.length>0&&(s=s.filter(l=>l.status===p.value.status)),t?.pagination&&(I.value.page=t.pagination.page,I.value.rowsPerPage=t.pagination.rowsPerPage),e.length>0&&(I.value.rowsNumber=s.length),P.value=s,P.value.length===0&&(D.value&&e.length===0?Q("No hay aprendices asignados a tus proyectos"):Q("No se encontraron aprendices"))}catch(e){P.value=[],I.value.rowsNumber=0,C(e.response?.data?.message||e.response?.data?.msg||"Error al cargar aprendices")}finally{k.value=!1}},Ie=t=>{ce.matched.some(s=>s.path.includes("aprendices")||s.name==="Apprentices"||s.path.includes("admin/aprendices"))&&t._id?me.push({name:"Apprentices",params:{ficheId:t._id},query:{edit:!0,apprenticeId:t._id}}):(r.value={_id:t._id||"",documentNumber:t.documentNumber||"",documentType:t.documentType||"",firstName:t.firstName||t.firstname||"",lastName:t.lastName||t.lastname||"",emailPersonal:z(t),emailInstitutional:q(t),phone:t.phone||"",recordNumber:K(t)},V.value=!0)},Ve=()=>({documentNumber:r.value.documentNumber,documentType:r.value.documentType,firstName:r.value.firstName,lastName:r.value.lastName,email:{personal:r.value.emailPersonal,institutional:r.value.emailInstitutional},phone:r.value.phone,recordNumber:[r.value.recordNumber]}),te=async()=>{if(!await j.value.validate()){C("Por favor complete todos los campos correctamente");return}const e=r.value._id;if(!e){C("ID del aprendiz no válido");return}L.value=!0;try{const s=Ve();await ze(Y.update(e),s),pe("Aprendiz actualizado exitosamente"),V.value=!1,j.value?.resetValidation(),await R()}catch(s){const l=s.response?.data,n=Array.isArray(l?.errors)?l.errors.join(`
`):l?.message||l?.msg||l?.error||"Error al actualizar el aprendiz";C(n)}finally{L.value=!1}};return Ce(()=>{R()}),se(()=>p.value.search,()=>{Z(),R()}),se(()=>p.value.status,()=>{Z(),R()}),(t,e)=>(ae(),De(je,{class:"q-pa-md"},{default:d(()=>[o($e),o(Qe,{title:"Mis Aprendices",description:"Listado y gestión de aprendices asignados."}),a("div",Ge,[a("div",Fe,[a("div",Xe,[a("div",Je,[a("div",Ye,[o(A,{modelValue:i(p).search,"onUpdate:modelValue":e[0]||(e[0]=s=>i(p).search=s),dense:"",outlined:"",placeholder:"Buscar por nombre, documento o email",clearable:"",debounce:"600",class:"custom-green-icons"},{prepend:d(()=>[o(T,{name:"search",color:"green-7"})]),_:1},8,["modelValue"])]),a("div",Ze,[o(oe,{modelValue:i(p).status,"onUpdate:modelValue":e[1]||(e[1]=s=>i(p).status=s),options:de,dense:"",outlined:"",label:"Estado",clearable:"","emit-value":"","map-options":"",class:"custom-green-icons"},{prepend:d(()=>[o(T,{name:"filter_list",color:"green-7"})]),_:1},8,["modelValue"])])])])]),o(He,{card:"",rows:i(P),columns:we,"row-key":"_id",loading:i(k),pagination:i(I),"rows-per-page-options":[10,20,50,100],onRequest:i(Ae)},{"body-cell-status":d(s=>[o(re,{props:s},{default:d(()=>[o(le,{color:ee(s.row.status)},{default:d(()=>[M(b(W(s.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-opciones":d(s=>[o(re,{props:s},{default:d(()=>[a("div",Ke,[o(ne,{icon:"visibility",tooltip:"Ver detalles",color:"primary",onClick:l=>i(_e)(s.row)},null,8,["onClick"]),o(ne,{icon:"edit",tooltip:"Editar",color:"primary",onClick:l=>Ie(s.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),"no-data":d(()=>[a("div",We,[o(T,{name:"person_off",size:"2.5em",color:"grey-5"}),e[13]||(e[13]=a("div",{class:"text-subtitle2 q-mt-sm"}," No hay aprendices registrados ",-1))])]),_:1},8,["rows","loading","pagination","onRequest"])]),o(ie,{modelValue:i(U),"onUpdate:modelValue":e[2]||(e[2]=s=>Me(U)?U.value=s:null),variant:"view",width:"1200px","max-width":"98vw"},{header:d(()=>[a("div",et,[a("div",tt,[o(T,{name:"person",class:"q-mr-sm"}),e[14]||(e[14]=M(" Detalles del Aprendiz ",-1))])])]),body:d(()=>[i(m)?(ae(),Se("div",st,[a("div",at,[e[20]||(e[20]=a("div",{class:"section-title"},"Datos Personales",-1)),a("div",ot,[a("div",lt,[e[15]||(e[15]=a("div",{class:"text-weight-bold"},"Tipo de Documento:",-1)),a("div",rt,b(i(m).documentType||"-"),1)]),a("div",it,[e[16]||(e[16]=a("div",{class:"text-weight-bold"},"Número de Documento:",-1)),a("div",nt,b(i(m).documentNumber||"-"),1)]),a("div",dt,[e[17]||(e[17]=a("div",{class:"text-weight-bold"},"Nombres:",-1)),a("div",ut,b(i(m).firstName||"-"),1)]),a("div",ct,[e[18]||(e[18]=a("div",{class:"text-weight-bold"},"Apellidos:",-1)),a("div",mt,b(i(m).lastName||"-"),1)]),a("div",pt,[e[19]||(e[19]=a("div",{class:"text-weight-bold"},"Estado:",-1)),a("div",ft,[o(le,{color:ee(i(m).status)},{default:d(()=>[M(b(W(i(m).status)),1)]),_:1},8,["color"])])])])]),a("div",vt,[e[25]||(e[25]=a("div",{class:"section-title"},"Datos de Contacto",-1)),a("div",gt,[a("div",bt,[e[21]||(e[21]=a("div",{class:"text-weight-bold"},"Teléfono:",-1)),a("div",Nt,b(i(m).phone||"-"),1)]),a("div",yt,[e[22]||(e[22]=a("div",{class:"text-weight-bold"},"Email Personal:",-1)),a("div",At,b(z(i(m))||"-"),1)]),a("div",_t,[e[23]||(e[23]=a("div",{class:"text-weight-bold"},"Email Institucional:",-1)),a("div",ht,b(q(i(m))||"-"),1)]),a("div",Et,[e[24]||(e[24]=a("div",{class:"text-weight-bold"},"Número de Ficha:",-1)),a("div",wt,b(K(i(m))||"-"),1)])])])])):ke("",!0)]),footer:d(()=>[o($,{label:"Cerrar","custom-class":"boton-cerrar",onClick:i(he)},null,8,["onClick"])]),_:1},8,["modelValue"]),o(ie,{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=s=>V.value=s),variant:"edit",width:"900px","max-width":"98vw",persistent:""},{header:d(()=>[a("div",It,[a("div",Vt,[o(T,{name:"edit",class:"q-mr-sm"}),e[26]||(e[26]=M(" Editar Aprendiz ",-1))])])]),body:d(()=>[o(Ue,{ref_key:"formRef",ref:j,onSubmit:Le(te,["prevent"])},{default:d(()=>[a("div",Tt,[a("div",xt,[e[27]||(e[27]=a("div",{class:"section-title"},"Datos de Identificación",-1)),o(oe,{filled:"",modelValue:r.value.documentType,"onUpdate:modelValue":e[3]||(e[3]=s=>r.value.documentType=s),options:ue,label:"Tipo de Documento *",rules:[N],disable:"",hint:"El tipo de documento no se puede editar","emit-value":"","map-options":""},null,8,["modelValue","rules"]),o(A,{filled:"",modelValue:r.value.documentNumber,"onUpdate:modelValue":e[4]||(e[4]=s=>r.value.documentNumber=s),label:"Número de Documento *",rules:[N,F,S(7),E(20),w],disable:"",hint:"El número de documento no se puede editar"},null,8,["modelValue","rules"]),e[28]||(e[28]=a("div",{class:"section-title q-mt-md"},"Nombres",-1)),o(A,{filled:"",modelValue:r.value.firstName,"onUpdate:modelValue":e[5]||(e[5]=s=>r.value.firstName=s),label:"Nombres *",rules:[N,S(h.MIN_NAME_LENGTH),E(h.MAX_NAME_LENGTH),X]},null,8,["modelValue","rules"]),o(A,{filled:"",modelValue:r.value.lastName,"onUpdate:modelValue":e[6]||(e[6]=s=>r.value.lastName=s),label:"Apellidos *",rules:[N,S(h.MIN_NAME_LENGTH),E(h.MAX_NAME_LENGTH),X]},null,8,["modelValue","rules"])]),a("div",Ct,[e[29]||(e[29]=a("div",{class:"section-title"},"Datos de Contacto",-1)),o(A,{filled:"",modelValue:r.value.phone,"onUpdate:modelValue":e[7]||(e[7]=s=>r.value.phone=s),label:"Teléfono *",type:"tel",rules:[N,ve,w]},null,8,["modelValue","rules"]),o(A,{filled:"",modelValue:r.value.emailPersonal,"onUpdate:modelValue":e[8]||(e[8]=s=>r.value.emailPersonal=s),label:"Email Personal *",type:"email",rules:[N,J,E(h.MAX_EMAIL_LENGTH),w]},null,8,["modelValue","rules"]),e[30]||(e[30]=a("div",{class:"section-title q-mt-md"},"Email Institucional",-1)),o(A,{filled:"",modelValue:r.value.emailInstitutional,"onUpdate:modelValue":e[9]||(e[9]=s=>r.value.emailInstitutional=s),label:"Email Institucional *",type:"email",rules:[N,J,E(h.MAX_EMAIL_LENGTH),w],hint:"Debe terminar en @sena.edu.co"},null,8,["modelValue","rules"]),e[31]||(e[31]=a("div",{class:"section-title q-mt-md"},"Número de Ficha",-1)),o(A,{filled:"",modelValue:r.value.recordNumber,"onUpdate:modelValue":e[10]||(e[10]=s=>r.value.recordNumber=s),label:"Número de Ficha *",rules:[N,F,w],hint:"Número de ficha del aprendiz"},null,8,["modelValue","rules"])])])]),_:1},512)]),footer:d(()=>[o($,{label:"Cancelar","custom-class":"boton-cerrar",onClick:e[11]||(e[11]=s=>V.value=!1)}),o($,{label:"Guardar","custom-class":"gradient-btn",onClick:te,loading:i(L)},null,8,["loading"])]),_:1},8,["modelValue"])]),_:1}))}},ts=Te(Dt,[["__scopeId","data-v-f19c3fc4"]]);export{ts as default};
