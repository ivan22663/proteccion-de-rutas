import{Q as se}from"./QBadge-pToOuXWH.js";import{Q as C}from"./QTd-Dz2_L_T4.js";import{Q as oe}from"./QTooltip-BIz5X8HU.js";import{x as pe,$ as Te,a0 as G,am as ye,m as Q,an as Pe,y as m,j as W,a7 as X,M as Fe,O as Ie,N as $e,ao as Be,_ as Ue,r as E,a5 as He,h as f,b as i,d as s,a as l,e as o,o as _,c as J,g as k,v as ie,l as p,t as c,F as le,p as re,i as A}from"./index-D8k0Z2VW.js";import{Q as ne}from"./QBanner-tZm71ZRY.js";import{Q as de,a as ue}from"./QItemLabel-BiKvV_tR.js";import{Q as ce}from"./QSelect-CCFBgF8v.js";import{Q as Oe}from"./QForm-BHoNUr4c.js";import{g as me,a as ze,p as Le}from"./apiClient-Vvvjylwf.js";import{u as je}from"./useNotifications-C15CMF32.js";import{u as Ke}from"./useEntityManager-6kUzRwOq.js";import{u as Ge}from"./authStore-BiRtblIW.js";import{B as Je}from"./BackButton-OAicZK4q.js";import{B as $}from"./Button-ByZOtwGJ.js";import{T as We}from"./Table-DrGgNztj.js";import{M as ge}from"./Modal-CwwUMTwV.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";import"./QList-D6hH9GPe.js";import"./QLinearProgress-C9Sex94R.js";const _e=pe({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(r,{slots:b}){const g=Te(ye,G);if(g===G)return console.error("QTimelineEntry needs to be child of QTimeline"),G;const v=Q(()=>`q-timeline__entry q-timeline__entry--${r.side}`+(r.icon!==void 0||r.avatar!==void 0?" q-timeline__entry--icon":"")),D=Q(()=>`q-timeline__dot text-${r.color||g.color}`),M=Q(()=>g.layout==="comfortable"&&g.side==="left");return()=>{const h=Pe(b.default,[]);if(r.body!==void 0&&h.unshift(r.body),r.heading===!0){const w=[m("div"),m("div"),m(r.tag,{class:"q-timeline__heading-title"},h)];return m("div",{class:"q-timeline__heading"},M.value===!0?w.reverse():w)}let y;r.icon!==void 0?y=[m(W,{class:"row items-center justify-center",name:r.icon})]:r.avatar!==void 0&&(y=[m("img",{class:"q-timeline__dot-img",src:r.avatar})]);const T=[m("div",{class:"q-timeline__subtitle"},[m("span",{},X(b.subtitle,[r.subtitle]))]),m("div",{class:D.value},y),m("div",{class:"q-timeline__content"},[m("h6",{class:"q-timeline__title"},X(b.title,[r.title]))].concat(h))];return m("li",{class:v.value},M.value===!0?T.reverse():T)}}}),ve=pe({name:"QTimeline",props:{...Fe,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},layout:{type:String,default:"dense",validator:r=>["dense","comfortable","loose"].includes(r)}},setup(r,{slots:b}){const g=$e(),v=Ie(r,g.proxy.$q);Be(ye,r);const D=Q(()=>`q-timeline q-timeline--${r.layout} q-timeline--${r.layout}--${r.side}`+(v.value===!0?" q-timeline--dark":""));return()=>m("ul",{class:D.value},X(b.default))}}),Xe={class:"q-pa-md"},Ye={class:"container"},Ze={class:"row q-mb-md"},et={class:"col-12 text-right"},tt={key:0,class:"q-pa-md"},at={class:"row q-col-gutter-md"},st={class:"col-12"},ot={class:"text-body1 text-weight-bold"},it={class:"col-12 col-md-6"},lt={class:"text-body1"},rt={class:"col-12 col-md-6"},nt={class:"text-body1"},dt={class:"col-12 col-md-6"},ut={class:"text-body1"},ct={class:"col-12 col-md-6"},mt={class:"col-12 col-md-4"},gt={class:"text-body1"},_t={class:"col-12 col-md-4"},vt={class:"text-body1"},pt={class:"col-12 col-md-4"},yt={class:"text-body1"},ft={class:"col-12"},bt={class:"text-body1"},ht={key:0,class:"col-12"},xt={key:1,class:"col-12"},wt={class:"modal-footer-buttons"},St={class:"text-h6"},qt={class:"row q-col-gutter-md"},Et={key:0,class:"col-12"},kt={class:"col-12"},At={class:"text-body2"},Dt={class:"col-12 col-md-6"},Rt={class:"col-12 col-md-6"},Vt={class:"col-12 col-md-6"},Nt={class:"col-12 col-md-6"},Ct={class:"col-12 col-md-6"},Qt={class:"col-12 col-md-6"},Mt={class:"col-12"},Tt={key:1,class:"col-12"},Pt={class:"modal-footer-buttons"},Ft={__name:"MyRegistrations",setup(r){const b={ACTIVE:0,INACTIVE:1},g=je(),v=t=>!!t||"Este campo es requerido",D=Ge(),M=()=>({_id:"",registration_number:"",modality_id:"",company_id:"",scheduled_start_date:"",total_requested_hours:0,working_days:5,daily_hours:8,apprentice_observations:""}),h={list:"/registrations/myRegistrations",create:"/registrations",update:t=>`/registrations/${t}`},y={listError:"Error al cargar tus registros",createSuccess:"Registro de EP creado exitosamente. Pendiente de validación administrativa.",createError:"Error al crear el registro",updateSuccess:"Registro actualizado exitosamente",updateError:"Error al actualizar el registro",noData:"No tienes registros de EP. ¡Crea tu primer registro!"},T=t=>{function e(d){return Array.isArray(d)?d:d?.registrations&&Array.isArray(d.registrations)?d.registrations:d?.msg&&Array.isArray(d.msg)?d.msg:d?.data&&Array.isArray(d.data)?d.data:d?.data?.registrations&&Array.isArray(d.data.registrations)?d.data.registrations:[]}const a=e(t);return{data:a,total:a.length}},{loading:w,rows:fe,selectedEntity:be,formData:n,isEditMode:S,openFormDialog:he,closeFormDialog:Y,openDetailsDialog:xe,resetForm:we,populateFormForEdit:Se,fetchEntities:qe}=Ke({entityName:"registration",entityNamePlural:"registrations",getDefaultFormData:M,endpoints:h,messages:y,processResponse:T}),Ee=fe,u=be,q=E(null),B=E(null),R=E(null),P=E([]),V=E([]),x=E([]),ke=Q(()=>{const t=D.user;return t?`${t.firstName||""} ${t.lastName||""}`.trim():"Aprendiz"}),Ae=[{name:"registrationNumber",label:"Número Registro",field:"registrationNumber",sortable:!0,align:"left"},{name:"modality",label:"Modalidad",field:"modality",sortable:!0,align:"left"},{name:"company",label:"Empresa",field:"company",sortable:!0,align:"left"},{name:"scheduledStartDate",label:"Fecha Inicio",field:"scheduledStartDate",sortable:!0,align:"center"},{name:"totalRequestedHours",label:"Horas Totales",field:"totalRequestedHours",sortable:!0,align:"center"},{name:"registrationStatus",label:"Estado",field:"registrationStatus",sortable:!0,align:"center",badge:!0,badgeColor:t=>H(t.registrationStatus||t.registration_status),format:(t,e)=>U(e.registrationStatus||e.registration_status)},{name:"opciones",label:"Opciones",align:"center",actions:[{icon:"visibility",tooltip:"Ver Detalles",action:t=>ee(t)},{icon:"edit",tooltip:"Editar",action:t=>te(t),condition:t=>O(t)}]}];function U(t){return{0:"Pendiente Validación",1:"Rechazado",2:"En Revisión",3:"Aprobado"}[t]||"Desconocido"}function H(t){return{0:"orange",1:"negative",2:"info",3:"positive"}[t]||"grey"}function O(t){return t.registration_status===0||t.registration_status===1}function N(t){return t?new Date(t).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A"}const Z=async()=>{await qe()};function ee(t){xe(t),B.value?.openDialog()}function te(t){if(!O(t)){g.warning("No puedes editar un registro ya aprobado o en revisión");return}Se(t),n.value.modality_id=t.modality_id?._id||"",n.value.company_id=t.company_id?._id||"",n.value.scheduled_start_date=t.scheduled_start_date?t.scheduled_start_date.split("T")[0]:"",n.value.total_requested_hours=t.total_requested_hours??0,n.value.working_days=t.working_days??5,n.value.daily_hours=t.daily_hours??8,n.value.apprentice_observations=t.apprentice_observations?.[t.apprentice_observations.length-1]?.descripcion||"",R.value?.openDialog()}function De(){we(),he(),R.value?.openDialog()}function Re(){Y(),R.value?.closeDialog(),q.value&&q.value.resetValidation()}const Ve=t=>({modality_id:t.modality_id,company_id:t.company_id,scheduled_start_date:t.scheduled_start_date,total_requested_hours:t.total_requested_hours,working_days:t.working_days,daily_hours:t.daily_hours,apprentice_observations:t.apprentice_observations,uploaded_documents:[]});async function Ne(){if(!await q.value.validate()){g.error("Por favor complete todos los campos correctamente");return}w.value=!0;try{const e=Ve(n.value);S.value?(await ze(h.update(n.value._id),e),g.success(y.updateSuccess)):(await Le(h.create,e),g.success(y.createSuccess)),R.value?.closeDialog(),Y(),q.value&&q.value.resetValidation(),await Z()}catch(e){const a=e?.response?.data?.message||e?.response?.data?.msg||e?.message||(S.value?y.updateError:y.createError);g.error(a)}finally{w.value=!1}}async function Ce(){try{const t=await me("/modalities/listModalities");t?.modalities&&Array.isArray(t.modalities)?P.value=t.modalities||[]:t?.data&&Array.isArray(t.data)?P.value=t.data||[]:Array.isArray(t)&&(P.value=t||[])}catch{}}async function Qe(){try{const t=await me("/companies/listCompanies");let e=[];t?.companies&&Array.isArray(t.companies)?e=t.companies:t?.data&&Array.isArray(t.data)?e=t.data:Array.isArray(t)&&(e=t),x.value=[];let a=0;for(;a<e.length;)e[a].status===b.ACTIVE&&x.value.push(e[a]),a++;for(V.value=[],a=0;a<x.value.length;)V.value.push(x.value[a]),a++}catch{}}function Me(t,e){e(()=>{if(t==="")V.value=x.value;else{const a=t.toLowerCase(),d=[];let z=0;for(;z<x.value.length;){const F=x.value[z];if(F&&F.name){const ae=F.name.toLowerCase();let L=0,j=!1;for(;L<=ae.length-a.length&&!j;){let I=0,K=!0;for(;I<a.length&&K;)ae[L+I]!==a[I]&&(K=!1),I++;K&&(j=!0),L++}j&&d.push(F)}z++}V.value=d}})}return He(async()=>{await Promise.all([Z(),Ce(),Qe()])}),(t,e)=>(_(),f("div",Xe,[i(Je,{to:"/app/aprendiz/inicio"}),e[27]||(e[27]=s("div",{class:"text-center q-mb-lg"},[s("h1",{class:"text-weight-bold text-black q-my-md",style:{"font-size":"3rem"}},"Registro de Etapa Productiva y Empresa")],-1)),s("div",Ye,[s("div",Ze,[s("div",et,[i($,{label:"+ Nuevo Registro EP","custom-class":"btn-ingresar",onClick:De,style:{height:"36px",padding:"8px 16px"},icon:"add_circle"})])]),i(We,{data:o(Ee),columns:Ae,"row-key":"_id","no-data-label":"No tienes registros de EP. ¡Crea tu primer registro!","rows-per-page-options":[10,20,50],"initial-rows-per-page":10},{"body-cell-registrationStatus":l(a=>[i(C,{props:a},{default:l(()=>[i(se,{color:H(a.row.registrationStatus||a.row.registration_status)},{default:l(()=>[p(c(U(a.row.registrationStatus||a.row.registration_status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-modality":l(a=>[i(C,{props:a},{default:l(()=>[p(c(a.row.modality_id?.name||"N/A"),1)]),_:2},1032,["props"])]),"body-cell-company":l(a=>[i(C,{props:a},{default:l(()=>[p(c(a.row.company_id?.name||"N/A"),1)]),_:2},1032,["props"])]),"body-cell-scheduledStartDate":l(a=>[i(C,{props:a},{default:l(()=>[p(c(N(a.row.scheduledStartDate||a.row.scheduled_start_date)),1)]),_:2},1032,["props"])]),"body-cell-opciones":l(a=>[i(C,{props:a,class:"text-center"},{default:l(()=>[i(ie,{flat:"",round:"",color:"primary",icon:"visibility",onClick:d=>ee(a.row)},{default:l(()=>[i(oe,null,{default:l(()=>[...e[9]||(e[9]=[p("Ver detalles",-1)])]),_:1})]),_:1},8,["onClick"]),O(a.row)?(_(),J(ie,{key:0,flat:"",round:"",color:"warning",icon:"edit",onClick:d=>te(a.row)},{default:l(()=>[i(oe,null,{default:l(()=>[...e[10]||(e[10]=[p("Editar",-1)])]),_:1})]),_:1},8,["onClick"])):k("",!0)]),_:2},1032,["props"])]),_:1},8,["data"])]),i(ge,{ref_key:"detailsModalRef",ref:B,width:"800px","max-width":"98vw"},{header:l(()=>[...e[11]||(e[11]=[s("div",{class:"text-h6"},"Detalles del Registro EP",-1)])]),body:l(()=>[o(u)?(_(),f("div",tt,[s("div",at,[s("div",st,[e[12]||(e[12]=s("div",{class:"text-subtitle2 text-grey-8"},"Número de Registro",-1)),s("div",ot,c(o(u).registration_number||"N/A"),1)]),s("div",it,[e[13]||(e[13]=s("div",{class:"text-subtitle2 text-grey-8"},"Modalidad",-1)),s("div",lt,c(o(u).modality_id?.name||"N/A"),1)]),s("div",rt,[e[14]||(e[14]=s("div",{class:"text-subtitle2 text-grey-8"},"Empresa",-1)),s("div",nt,c(o(u).company_id?.name||"N/A"),1)]),s("div",dt,[e[15]||(e[15]=s("div",{class:"text-subtitle2 text-grey-8"},"Fecha de Inicio",-1)),s("div",ut,c(N(o(u).scheduledStartDate||o(u).scheduled_start_date)),1)]),s("div",ct,[e[16]||(e[16]=s("div",{class:"text-subtitle2 text-grey-8"},"Estado",-1)),s("div",null,[i(se,{color:H(o(u).registrationStatus||o(u).registration_status)},{default:l(()=>[p(c(U(o(u).registrationStatus||o(u).registration_status)),1)]),_:1},8,["color"])])]),s("div",mt,[e[17]||(e[17]=s("div",{class:"text-subtitle2 text-grey-8"},"Total Horas Solicitadas",-1)),s("div",gt,c(o(u).totalRequestedHours||o(u).total_requested_hours||0)+" horas",1)]),s("div",_t,[e[18]||(e[18]=s("div",{class:"text-subtitle2 text-grey-8"},"Días Laborales",-1)),s("div",vt,c(o(u).working_days)+" días/semana",1)]),s("div",pt,[e[19]||(e[19]=s("div",{class:"text-subtitle2 text-grey-8"},"Horas Diarias",-1)),s("div",yt,c(o(u).daily_hours)+" horas/día",1)]),s("div",ft,[e[20]||(e[20]=s("div",{class:"text-subtitle2 text-grey-8"},"Fecha de Registro",-1)),s("div",bt,c(N(o(u).registration_date)),1)]),o(u).apprentice_observations?.length>0?(_(),f("div",ht,[e[21]||(e[21]=s("div",{class:"text-subtitle2 text-grey-8 q-mb-sm"},"Mis Observaciones",-1)),i(ve,{color:"primary"},{default:l(()=>[(_(!0),f(le,null,re(o(u).apprentice_observations,(a,d)=>(_(),J(_e,{key:d,title:N(a.fecha),subtitle:a.escrito_por},{default:l(()=>[s("div",null,c(a.descripcion),1)]),_:2},1032,["title","subtitle"]))),128))]),_:1})])):k("",!0),o(u).admin_observations?.length>0?(_(),f("div",xt,[e[22]||(e[22]=s("div",{class:"text-subtitle2 text-grey-8 q-mb-sm"},"Observaciones del Administrador",-1)),i(ve,{color:"secondary"},{default:l(()=>[(_(!0),f(le,null,re(o(u).admin_observations,(a,d)=>(_(),J(_e,{key:d,title:N(a.fecha),subtitle:a.escrito_por},{default:l(()=>[s("div",null,c(a.descripcion),1)]),_:2},1032,["title","subtitle"]))),128))]),_:1})])):k("",!0)])])):k("",!0)]),footer:l(()=>[s("div",wt,[i($,{label:"Cerrar","custom-class":"btn-cancelar",onClick:e[0]||(e[0]=a=>B.value?.closeDialog())})])]),_:1},512),i(ge,{ref_key:"editModalRef",ref:R,width:"900px","max-width":"98vw"},{header:l(()=>[s("div",St,c(o(S)?"Editar":"Nuevo")+" Registro de Etapa Productiva",1)]),body:l(()=>[i(Oe,{ref_key:"formRef",ref:q,class:"q-pa-md"},{default:l(()=>[s("div",qt,[o(S)?(_(),f("div",Et,[i(A,{modelValue:o(n).registration_number,"onUpdate:modelValue":e[1]||(e[1]=a=>o(n).registration_number=a),label:"Número de Registro",outlined:"",dense:"",readonly:"",hint:"Número de registro asignado"},null,8,["modelValue"])])):k("",!0),s("div",kt,[i(ne,{class:"bg-blue-1"},{avatar:l(()=>[i(W,{name:"account_circle",color:"primary"})]),default:l(()=>[s("div",At,[e[23]||(e[23]=s("strong",null,"Registrando para:",-1)),p(" "+c(ke.value),1)])]),_:1})]),s("div",Dt,[i(ce,{modelValue:o(n).modality_id,"onUpdate:modelValue":e[2]||(e[2]=a=>o(n).modality_id=a),options:P.value,"option-value":"_id","option-label":"name","emit-value":"","map-options":"",label:"Modalidad EP *",outlined:"",dense:"",rules:[v],hint:"Selecciona la modalidad de tu etapa productiva"},{"no-option":l(()=>[i(de,null,{default:l(()=>[i(ue,{class:"text-grey"},{default:l(()=>[...e[24]||(e[24]=[p(" No hay modalidades disponibles ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","rules"])]),s("div",Rt,[i(ce,{modelValue:o(n).company_id,"onUpdate:modelValue":e[3]||(e[3]=a=>o(n).company_id=a),options:V.value,"option-value":"_id","option-label":"name","emit-value":"","map-options":"",label:"Empresa *",outlined:"",dense:"",rules:[v],hint:"Empresa donde realizarás la EP","use-input":"","input-debounce":"300",onFilter:Me},{"no-option":l(()=>[i(de,null,{default:l(()=>[i(ue,{class:"text-grey"},{default:l(()=>[...e[25]||(e[25]=[p(" No hay empresas disponibles ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","rules"])]),s("div",Vt,[i(A,{modelValue:o(n).scheduled_start_date,"onUpdate:modelValue":e[4]||(e[4]=a=>o(n).scheduled_start_date=a),label:"Fecha de Inicio Programada *",outlined:"",dense:"",type:"date",rules:[v],hint:"Fecha en que inicias la etapa productiva"},null,8,["modelValue","rules"])]),s("div",Nt,[i(A,{modelValue:o(n).total_requested_hours,"onUpdate:modelValue":e[5]||(e[5]=a=>o(n).total_requested_hours=a),modelModifiers:{number:!0},label:"Total Horas Solicitadas *",outlined:"",dense:"",type:"number",rules:[v,a=>a>0||"Debe ser mayor a 0"],hint:"Total de horas de la etapa productiva"},null,8,["modelValue","rules"])]),s("div",Ct,[i(A,{modelValue:o(n).working_days,"onUpdate:modelValue":e[6]||(e[6]=a=>o(n).working_days=a),modelModifiers:{number:!0},label:"Días Laborales por Semana *",outlined:"",dense:"",type:"number",rules:[v,a=>a>=1&&a<=7||"Debe estar entre 1 y 7"],hint:"Número de días que trabajarás por semana"},null,8,["modelValue","rules"])]),s("div",Qt,[i(A,{modelValue:o(n).daily_hours,"onUpdate:modelValue":e[7]||(e[7]=a=>o(n).daily_hours=a),modelModifiers:{number:!0},label:"Horas Diarias *",outlined:"",dense:"",type:"number",rules:[v,a=>a>=1&&a<=24||"Debe estar entre 1 y 24"],hint:"Horas que trabajarás por día"},null,8,["modelValue","rules"])]),s("div",Mt,[i(A,{modelValue:o(n).apprentice_observations,"onUpdate:modelValue":e[8]||(e[8]=a=>o(n).apprentice_observations=a),label:"Observaciones (opcional)",outlined:"",dense:"",type:"textarea",rows:"3",hint:"Puedes agregar comentarios o detalles adicionales",counter:"",maxlength:"500"},null,8,["modelValue"])]),o(S)?(_(),f("div",Tt,[i(ne,{class:"bg-orange-1"},{avatar:l(()=>[i(W,{name:"warning",color:"orange"})]),default:l(()=>[e[26]||(e[26]=s("div",{class:"text-body2"}," Solo puedes editar registros que aún no han sido validados por el administrador. ",-1))]),_:1})])):k("",!0)])]),_:1},512)]),footer:l(()=>[s("div",Pt,[i($,{label:"Cancelar","custom-class":"btn-cancelar",onClick:Re}),i($,{label:o(S)?"Actualizar":"Registrar","custom-class":"btn-enviar",onClick:Ne,loading:o(w)},null,8,["label","loading"])])]),_:1},512)]))}},ia=Ue(Ft,[["__scopeId","data-v-ce5aa0c4"]]);export{ia as default};
