import{_ as x,r as v,m as B,c as y,a as c,u as E,n as P,o as g,b as r,d as l,Q as V,e as F,f as N,j as I,h as T,F as A,p as D,i as K,l as $,q as m}from"./index-D8k0Z2VW.js";import{Q as L,a as z,l as H,b as M,c as O,d as U}from"./LogoSENABlanco-CtklxWB6.js";import{Q as j}from"./QPageContainer-CjE1gXqS.js";import{u as W}from"./useNotifications-C15CMF32.js";import{a as G}from"./apiClient-Vvvjylwf.js";import{B as J}from"./Button-ByZOtwGJ.js";import{B as X}from"./BackButton-OAicZK4q.js";const Y={class:"header-content"},Z=["src"],ee={class:"main-wrapper"},te={class:"back-button-wrapper"},oe={class:"content-center"},ae={class:"icon-section"},se={class:"icon-container"},ne={class:"code-inputs-container"},le={class:"reenviar-section"},re={class:"button-section"},ie={__name:"EnterPasswordCode",setup(ce){const C=E(),_=P(),u=W(),p=v(!1),h=v(!1),s=v(["","","","","",""]),i=v([]),w=B(()=>{let t=0,e=!0;for(;t<s.value.length&&e;)s.value[t]===""&&(e=!1),t++;return e}),q=()=>{let t="",e=0;for(;e<s.value.length;)t+=s.value[e]||"",e++;return t};async function k(t,e){const o=e.target.value;if(console.log("handleInput llamado - index:",t,"value:",o),o&&/^\d$/.test(o)){if(s.value[t]=o,console.log("Código actualizado:",s.value),t<5){console.log("Intentando mover al siguiente input, index actual:",t),await m();const a=i.value[t+1];if(console.log("nextInputComponent:",a),a){console.log("nextInputComponent.$el:",a.$el);const n=a.$el?.querySelector("input")||a.$refs?.input?.$el?.querySelector("input")||a.$el?.querySelector(".q-field__native");console.log("nativeInput encontrado:",n),n?(n.focus(),n.select(),console.log("Focus aplicado al siguiente input")):console.log("No se pudo encontrar el nativeInput")}else console.log("nextInputComponent es null o undefined")}}else o?(s.value[t]="",e.target.value=""):s.value[t]=""}function b(t,e){if(e.key==="Backspace"){if(!s.value[t]&&t>0){const o=i.value[t-1];if(o&&o.$el){const a=o.$el.querySelector("input");a&&a.focus()}}}else if(e.key==="ArrowLeft"&&t>0){const o=i.value[t-1];if(o&&o.$el){const a=o.$el.querySelector("input");a&&a.focus()}}else if(e.key==="ArrowRight"&&t<5){const o=i.value[t+1];if(o&&o.$el){const a=o.$el.querySelector("input");a&&a.focus()}}}function Q(t){t.preventDefault();const e=t.clipboardData.getData("text").slice(0,6);if(/^\d+$/.test(e)){let o=0;for(;o<e.length&&o<6;)s.value[o]=e[o],o++;let a=-1,n=0;for(;n<s.value.length&&a===-1;)s.value[n]===""&&(a=n),n++;if(a!==-1){const d=i.value[a];if(d&&d.$el){const f=d.$el.querySelector("input");f&&f.focus()}}else{const d=i.value[5];if(d&&d.$el){const f=d.$el.querySelector("input");f&&f.focus()}}}}function R(){const t=_.query.email;if(!t){u.error("No se encontró el correo electrónico");return}h.value=!0,G(`/apprentices/resetPassword/${t}`).then(e=>{u.success(e.msg||e.message||"Código reenviado. Revisa tu correo electrónico."),s.value=["","","","","",""],m(()=>{const o=i.value[0];if(o&&o.$el){const a=o.$el.querySelector("input");a&&a.focus()}})}).catch(e=>{const o=e.response?.data?.msg||e.response?.data?.message||e.response?.data?.error||"Error al reenviar el código. Intenta nuevamente.";u.error(o)}).finally(()=>{h.value=!1})}async function S(){p.value=!0;try{const t=q(),e=_.query.email;if(!e){u.error("No se encontró el correo electrónico"),p.value=!1;return}if(!t||t.length!==6){u.error("El código debe tener 6 dígitos"),p.value=!1;return}u.success("Código verificado correctamente"),C.push({path:"/NuevaContrasena",query:{code:t,email:e}})}catch(t){const e=t.response?.data?.msg||t.response?.data?.message||t.response?.data?.error||"Código inválido o expirado";u.error(e),s.value=["","","","","",""],m(()=>{const o=i.value[0];if(o&&o.$el){const a=o.$el.querySelector("input");a&&a.focus()}})}finally{p.value=!1}}return(t,e)=>(g(),y(L,{view:"hHh lpR fFf"},{default:c(()=>[r(z,{elevated:"",class:"text-white header-custom"},{default:c(()=>[l("div",Y,[r(V,{class:"header-avatar"},{default:c(()=>[l("img",{src:F(H),class:"avatar-img"},null,8,Z)]),_:1}),e[0]||(e[0]=l("span",{class:"header-title"},"REPFORA EP",-1))])]),_:1}),r(j,{class:"page-container"},{default:c(()=>[l("div",ee,[l("div",te,[r(X)]),l("div",oe,[r(N,{class:"recovery-card",flat:""},{default:c(()=>[l("div",ae,[l("div",se,[r(I,{name:"lock_reset",class:"icon-main",color:"green-6"})]),e[1]||(e[1]=l("div",{class:"title-section"}," Ingrese código ",-1))]),e[3]||(e[3]=l("div",{class:"description-section"}," Revisa tu correo electrónico para encontrar un código de verificación para restablecer tu contraseña. Si no aparece en unos minutos, revisa tu carpeta de correo no deseado. ",-1)),l("div",ne,[(g(!0),T(A,null,D(s.value,(o,a)=>(g(),y(K,{key:a,modelValue:s.value[a],"onUpdate:modelValue":n=>s.value[a]=n,ref_for:!0,ref:n=>i.value[a]=n,outlined:"",maxlength:"1",class:"code-input",onInput:n=>k(a,n),onKeydown:n=>b(a,n),onPaste:Q,"input-class":"text-center"},null,8,["modelValue","onUpdate:modelValue","onInput","onKeydown"]))),128))]),l("div",le,[l("a",{onClick:R,class:"reenviar-link"},[r(I,{name:"refresh",size:"18px",class:"q-mr-xs"}),e[2]||(e[2]=$(" Reenviar código ",-1))])]),l("div",re,[r(J,{onClick:S,loading:p.value,disable:!w.value},null,8,["loading","disable"])])]),_:1})])])]),_:1}),r(M,{class:"footer-custom"},{default:c(()=>[r(O,{class:"footer-toolbar"},{default:c(()=>[r(U,{class:"text-center footer-text"},{default:c(()=>[...e[4]||(e[4]=[$(" REPFORA - Sena 2025 © Todos los derechos reservados ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))}},_e=x(ie,[["__scopeId","data-v-111d63ed"]]);export{_e as default};
