import{_ as ue,r as y,a5 as me,c as C,a as i,o as v,b as o,d as e,f as ve,s as pe,e as s,j as f,af as Y,g as w,l as c,t as d,z as ge,h,F as be,p as fe,ae as P,i as j}from"./index-D8k0Z2VW.js";import{Q as we}from"./QSelect-CCFBgF8v.js";import{Q as J}from"./QBadge-pToOuXWH.js";import{Q as g}from"./QTd-Dz2_L_T4.js";import{Q}from"./QForm-BHoNUr4c.js";import{Q as _e}from"./QPage-CDUm3vNP.js";import{C as ye}from"./ClosePopup-DkFGp95i.js";import{u as he}from"./useEntityManager-6kUzRwOq.js";import{u as xe}from"./useNotifications-C15CMF32.js";import{a as U}from"./apiClient-Vvvjylwf.js";import{B as De}from"./BackButton-OAicZK4q.js";import{T as Re}from"./Table-DrGgNztj.js";import{B as b}from"./Button-ByZOtwGJ.js";import{_ as V}from"./ButtonTableOptions-ivpzFDPv.js";import{M as A}from"./Modal-CwwUMTwV.js";import{P as Se}from"./PageHeader-BZtJRD6F.js";import"./QItemLabel-BiKvV_tR.js";import"./position-engine-BrzQKXCo.js";import"./selection-CjJDPdFp.js";import"./format-DyQxkAtJ.js";import"./QList-D6hH9GPe.js";import"./QLinearProgress-C9Sex94R.js";import"./QTooltip-BIz5X8HU.js";const qe={class:"full-width row"},Ie={class:"col-12"},ke={class:"filters-wrapper flex items-center justify-between q-my-lg"},Ce={class:"filters-left flex items-center bg-white"},Ve={class:"filter-item status"},Ae={class:"q-pa-md flex flex-center column text-grey full-width"},Ee={class:"modal-header"},Ne={class:"text-h6 flex items-center"},ze={key:0,class:"modal-content-grid"},Pe={class:"modal-column"},je={class:"data-grid"},Qe={class:"data-row"},Ue={class:"data-value"},Me={class:"data-row"},Te={class:"data-value"},$e={class:"data-row"},Oe={class:"data-value"},Be={class:"data-row"},Fe={class:"data-value"},He={class:"data-grid"},Le={class:"data-row"},Ge={class:"data-value"},Ye={class:"data-row"},Je={class:"data-value"},Ke={class:"data-row"},We={class:"data-value"},Xe={class:"data-row"},Ze={class:"data-value"},et={class:"data-row"},tt={class:"data-value"},at={class:"modal-column"},st={class:"data-grid"},ot={class:"data-row"},lt={class:"data-value"},it={class:"data-row"},rt={class:"data-value"},dt={class:"data-row"},nt={class:"data-value"},ct={class:"data-row"},ut={class:"data-value"},mt={class:"data-row"},vt={class:"data-value"},pt={class:"data-row"},gt={class:"data-value"},bt={class:"data-row"},ft={class:"data-value"},wt={class:"data-row"},_t={class:"data-value"},yt={key:0,class:"section-title q-mt-lg"},ht={key:1,class:"data-grid"},xt={class:"text-caption text-grey-7"},Dt={class:"text-body2"},Rt={class:"modal-header"},St={class:"text-h6 flex items-center"},qt={class:"q-pa-md"},It={class:"row justify-end q-gutter-sm full-width"},kt={class:"modal-header"},Ct={class:"text-h6 flex items-center"},Vt={class:"q-pa-md"},At={class:"row justify-end q-gutter-sm full-width"},Et={class:"modal-header"},Nt={class:"text-h6 flex items-center"},zt={class:"q-pa-md"},Pt={class:"row justify-end q-gutter-sm full-width"},jt={__name:"pre-registrations",setup(Qt){const K=()=>({_id:"",apprenticeId:null,modalityId:null,companyId:null,companyData:null,scheduledStartDate:"",totalRequestedHours:0,totalRequestedMonths:0,workingDays:5,dailyHours:8,senaRequiredArl:!1,status:1}),x={list:"/preRegistrations/listPreRegistrations",create:"/preRegistrations/savePreRegistration",update:l=>`/preRegistrations/updatePreRegistration/${l}`,approve:l=>`/preRegistrations/aprovedPreRegistration/${l}`,reject:l=>`/preRegistrations/rejectedPreRegistration/${l}`,observation:l=>`/preRegistrations/createObservation/${l}`},D={listError:"Error al listar las solicitudes",approveSuccess:"Solicitud aprobada correctamente",rejectSuccess:"Solicitud rechazada correctamente",observationSuccess:"Observación agregada correctamente"},{loading:u,loadingTable:W,rows:X,showDetailDialog:E,selectedEntity:Z,filtersData:M,pagination:N,handlePaginationRequest:ee,handleStatusChange:te,openDetailsDialog:ae,fetchEntities:se}=he({entityName:"solicitud",entityNamePlural:"preRegistrations",getDefaultFormData:K,endpoints:x,messages:D}),oe=X,r=Z,le=ae,R=se,{error:_,success:z}=xe(),S=y(!1),q=y(!1),I=y(!1),n=y(""),m=y(null),ie=[{label:"Todos los estados",value:""},{label:"Aprobado",value:0},{label:"Pendiente",value:1},{label:"Rechazado",value:2}],re=[{name:"apprentice",label:"Aprendiz",align:"center",field:"apprenticeId"},{name:"modality",label:"Modalidad",align:"center",field:"modalityId"},{name:"company",label:"Empresa",align:"center",field:"companyId"},{name:"startDate",label:"Fecha Inicio",align:"center",field:"startDate"},{name:"status",label:"Estado",align:"center",field:"status"},{name:"options",label:"Acciones",align:"center"}],T=l=>({0:"positive",1:"warning",2:"negative"})[l]||"grey",$=l=>({0:"Aprobado",1:"Pendiente",2:"Rechazado"})[l]||"Desconocido",k=l=>{if(!l)return"-";const t=new Date(l),a=t.getUTCFullYear(),p=String(t.getUTCMonth()+1).padStart(2,"0");return`${String(t.getUTCDate()).padStart(2,"0")}/${p}/${a}`},de=l=>{m.value=l._id,n.value="",S.value=!0},O=()=>{S.value=!1,m.value=null,n.value=""},ne=l=>{m.value=l._id,n.value="",q.value=!0},B=()=>{q.value=!1,m.value=null,n.value=""},ce=l=>{m.value=l._id,n.value="",I.value=!0},F=()=>{I.value=!1,m.value=null,n.value=""},H=async()=>{u.value=!0;try{const l={};n.value?.trim()&&(l.observation=n.value.trim());const t=await U(x.approve(m.value),l);z(t?.msg||D.approveSuccess),O(),await R()}catch(l){_(l?.response?.data?.msg||l?.message||"Error al aprobar la solicitud")}finally{u.value=!1}},L=async()=>{if(!n.value?.trim()){_("Debes especificar el motivo del rechazo");return}u.value=!0;try{const l=await U(x.reject(m.value),{observation:n.value.trim()});z(l?.msg||D.rejectSuccess),B(),await R()}catch(l){_(l?.response?.data?.msg||l?.message||"Error al rechazar la solicitud")}finally{u.value=!1}},G=async()=>{if(!n.value?.trim()){_("La observación es requerida");return}u.value=!0;try{const l=await U(x.observation(m.value),{observation:n.value.trim()});z(l?.msg||D.observationSuccess),F(),await R()}catch(l){_(l?.response?.data?.msg||l?.message||"Error al agregar la observación")}finally{u.value=!1}};return me(async()=>{await R()}),(l,t)=>(v(),C(_e,{class:"q-pa-md solicitudes-page"},{default:i(()=>[o(De,{class:"q-mb-lg"}),e("div",qe,[e("div",Ie,[o(ve,{class:"shadow-1 hero-card q-mb-xl"},{default:i(()=>[o(pe,null,{default:i(()=>[o(Se,{title:"Gestión de Solicitudes",description:"Revisa, aprueba o rechaza las solicitudes de registro de etapa productiva."})]),_:1})]),_:1}),e("div",ke,[e("div",Ce,[e("div",Ve,[o(we,{modelValue:s(M).status,"onUpdate:modelValue":[t[0]||(t[0]=a=>s(M).status=a),s(te)],options:ie,outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",label:"Filtrar por Estado"},{prepend:i(()=>[o(f,{name:"filter_list",color:"green-8"})]),_:1},8,["modelValue","onUpdate:modelValue"])])])]),o(Re,{card:"",rows:s(oe),columns:re,pagination:s(N),"onUpdate:pagination":t[1]||(t[1]=a=>Y(N)?N.value=a:null),"loanding-table":s(W),"row-key":"_id",onRequest:s(ee)},{"body-cell-status":i(a=>[o(g,{props:a},{default:i(()=>[o(J,{color:T(a.row.status),class:"text-uppercase"},{default:i(()=>[c(d($(a.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-apprentice":i(a=>[o(g,{props:a},{default:i(()=>[c(d(a.row.apprenticeId?.firstName||"-")+" "+d(a.row.apprenticeId?.lastName||""),1)]),_:2},1032,["props"])]),"body-cell-modality":i(a=>[o(g,{props:a},{default:i(()=>[c(d(a.row.modalityId?.name||"-"),1)]),_:2},1032,["props"])]),"body-cell-company":i(a=>[o(g,{props:a},{default:i(()=>[c(d(a.row.companyId?.name||a.row.companyData?.name||"-"),1)]),_:2},1032,["props"])]),"body-cell-scheduledStartDate":i(a=>[o(g,{props:a},{default:i(()=>[c(d(k(a.row.startDate)),1)]),_:2},1032,["props"])]),"body-cell-startDate":i(a=>[o(g,{props:a},{default:i(()=>[c(d(k(a.row.startDate)),1)]),_:2},1032,["props"])]),"body-cell-options":i(a=>[o(g,{props:a,class:"text-center table-options"},{default:i(()=>[o(V,{icon:"visibility",color:"grey-7",tooltip:"Ver Detalles",onClick:p=>s(le)(a.row)},null,8,["onClick"]),a.row.status===1?(v(),C(V,{key:0,icon:"check_circle",color:"positive",tooltip:"Aprobar",onClick:p=>de(a.row)},null,8,["onClick"])):w("",!0),a.row.status===1?(v(),C(V,{key:1,icon:"cancel",color:"negative",tooltip:"Rechazar",onClick:p=>ne(a.row)},null,8,["onClick"])):w("",!0),a.row.status===1?(v(),C(V,{key:2,icon:"comment",color:"warning",tooltip:"Agregar Observación",onClick:p=>ce(a.row)},null,8,["onClick"])):w("",!0)]),_:2},1032,["props"])]),"no-data":i(()=>[e("div",Ae,[o(f,{name:"description",size:"2.5em",color:"positive"}),t[9]||(t[9]=e("div",{class:"text-subtitle2 q-mt-sm"}," No hay solicitudes registradas ",-1))])]),_:1},8,["rows","pagination","loanding-table","onRequest"]),o(A,{modelValue:s(E),"onUpdate:modelValue":t[2]||(t[2]=a=>Y(E)?E.value=a:null),width:"1000px","max-width":"95vw"},{header:i(()=>[e("div",Ee,[e("div",Ne,[o(f,{name:"description",class:"q-mr-sm"}),t[10]||(t[10]=c(" Detalles de la Solicitud ",-1))])])]),body:i(()=>[s(r)?(v(),h("div",ze,[e("div",Pe,[t[20]||(t[20]=e("div",{class:"section-title"},"Información del Aprendiz",-1)),e("div",je,[e("div",Qe,[t[11]||(t[11]=e("div",{class:"text-weight-bold"},"Nombre:",-1)),e("div",Ue,d(s(r).apprenticeId?.firstName||"-")+" "+d(s(r).apprenticeId?.lastName||""),1)]),e("div",Me,[t[12]||(t[12]=e("div",{class:"text-weight-bold"},"Documento:",-1)),e("div",Te,d(s(r).apprenticeId?.documentType||"-")+" "+d(s(r).apprenticeId?.documentNumber||"-"),1)]),e("div",$e,[t[13]||(t[13]=e("div",{class:"text-weight-bold"},"Email:",-1)),e("div",Oe,d(s(r).apprenticeId?.email?.institutional||s(r).apprenticeId?.email?.personal||"-"),1)]),e("div",Be,[t[14]||(t[14]=e("div",{class:"text-weight-bold"},"Teléfono:",-1)),e("div",Fe,d(s(r).apprenticeId?.phone||"-"),1)])]),t[21]||(t[21]=e("div",{class:"section-title q-mt-lg"},"Información de la Empresa",-1)),e("div",He,[e("div",Le,[t[15]||(t[15]=e("div",{class:"text-weight-bold"},"Razón Social:",-1)),e("div",Ge,d(s(r).companyId?.name||s(r).companyData?.name||"-"),1)]),e("div",Ye,[t[16]||(t[16]=e("div",{class:"text-weight-bold"},"NIT:",-1)),e("div",Je,d(s(r).companyId?.companyNit||s(r).companyData?.companyNit||"-"),1)]),e("div",Ke,[t[17]||(t[17]=e("div",{class:"text-weight-bold"},"Ubicación:",-1)),e("div",We,d(s(r).companyId?.location||s(r).companyData?.location||"-"),1)]),e("div",Xe,[t[18]||(t[18]=e("div",{class:"text-weight-bold"},"Representante Legal:",-1)),e("div",Ze,d(s(r).companyId?.legalRepresentativeName||s(r).companyData?.legalRepresentativeName||"-"),1)]),e("div",et,[t[19]||(t[19]=e("div",{class:"text-weight-bold"},"Cargo:",-1)),e("div",tt,d(s(r).companyId?.legalRepresentativePosition||s(r).companyData?.legalRepresentativePosition||"-"),1)])])]),e("div",at,[t[30]||(t[30]=e("div",{class:"section-title"},"Detalles de la Solicitud",-1)),e("div",st,[e("div",ot,[t[22]||(t[22]=e("div",{class:"text-weight-bold"},"Modalidad:",-1)),e("div",lt,d(s(r).modalityId?.name||"-"),1)]),e("div",it,[t[23]||(t[23]=e("div",{class:"text-weight-bold"},"Fecha Inicio:",-1)),e("div",rt,d(k(s(r).startDate)),1)]),e("div",dt,[t[24]||(t[24]=e("div",{class:"text-weight-bold"},"Horas Solicitadas:",-1)),e("div",nt,d(s(r).totalRequestedHours||0)+" horas",1)]),e("div",ct,[t[25]||(t[25]=e("div",{class:"text-weight-bold"},"Meses Solicitados:",-1)),e("div",ut,d(s(r).totalRequestedMonths||0)+" meses",1)]),e("div",mt,[t[26]||(t[26]=e("div",{class:"text-weight-bold"},"Días Laborales:",-1)),e("div",vt,d(s(r).workingDays||"-"),1)]),e("div",pt,[t[27]||(t[27]=e("div",{class:"text-weight-bold"},"Horas Diarias:",-1)),e("div",gt,d(s(r).dailyHours||"-"),1)]),e("div",bt,[t[28]||(t[28]=e("div",{class:"text-weight-bold"},"Requiere ARL SENA:",-1)),e("div",ft,d(s(r).senaRequiredArl?"Sí":"No"),1)]),e("div",wt,[t[29]||(t[29]=e("div",{class:"text-weight-bold"},"Estado:",-1)),e("div",_t,[o(J,{color:T(s(r).status)},{default:i(()=>[c(d($(s(r).status)),1)]),_:1},8,["color"])])])]),s(r).observation?.length?(v(),h("div",yt," Observaciones ")):w("",!0),s(r).observation?.length?(v(),h("div",ht,[(v(!0),h(be,null,fe(s(r).observation,(a,p)=>(v(),h("div",{key:p,class:"observation-item"},[e("div",xt,d(k(a.createdAt)),1),e("div",Dt,d(a.observation),1)]))),128))])):w("",!0)])])):w("",!0)]),footer:i(()=>[ge(o(b,{label:"Cerrar","custom-class":"boton-cerrar"},null,512),[[ye]])]),_:1},8,["modelValue"]),o(A,{modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=a=>S.value=a),width:"600px","max-width":"95vw",persistent:""},{header:i(()=>[e("div",Rt,[e("div",St,[o(f,{name:"check_circle",class:"q-mr-sm"}),t[31]||(t[31]=c(" Aprobar Solicitud ",-1))])])]),body:i(()=>[o(Q,{onSubmit:P(H,["prevent"])},{default:i(()=>[e("div",qt,[t[32]||(t[32]=e("p",{class:"text-body1 q-mb-md"}," ¿Estás seguro de aprobar esta solicitud? ",-1)),o(j,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=a=>n.value=a),filled:"",type:"textarea",label:"Observación (opcional)",rows:"4",hint:"Puedes agregar comentarios adicionales"},null,8,["modelValue"])])]),_:1})]),footer:i(()=>[e("div",It,[o(b,{label:"Cancelar","custom-class":"boton-cerrar",onClick:O}),o(b,{label:"Aprobar","custom-class":"gradient-btn",loading:s(u),onClick:H},null,8,["loading"])])]),_:1},8,["modelValue"]),o(A,{modelValue:q.value,"onUpdate:modelValue":t[6]||(t[6]=a=>q.value=a),width:"600px","max-width":"95vw",persistent:""},{header:i(()=>[e("div",kt,[e("div",Ct,[o(f,{name:"cancel",class:"q-mr-sm"}),t[33]||(t[33]=c(" Rechazar Solicitud ",-1))])])]),body:i(()=>[o(Q,{onSubmit:P(L,["prevent"])},{default:i(()=>[e("div",Vt,[t[34]||(t[34]=e("p",{class:"text-body1 q-mb-md text-negative"}," Estás a punto de rechazar esta solicitud. ",-1)),o(j,{modelValue:n.value,"onUpdate:modelValue":t[5]||(t[5]=a=>n.value=a),filled:"",type:"textarea",label:"Motivo del rechazo *",rows:"4",rules:[a=>!!a?.trim()||"Debes especificar el motivo del rechazo"],hint:"Explica claramente por qué se rechaza la solicitud"},null,8,["modelValue","rules"])])]),_:1})]),footer:i(()=>[e("div",At,[o(b,{label:"Cancelar","custom-class":"boton-cerrar",onClick:B}),o(b,{label:"Rechazar","custom-class":"gradient-btn",loading:s(u),onClick:L},null,8,["loading"])])]),_:1},8,["modelValue"]),o(A,{modelValue:I.value,"onUpdate:modelValue":t[8]||(t[8]=a=>I.value=a),width:"600px","max-width":"95vw",persistent:""},{header:i(()=>[e("div",Et,[e("div",Nt,[o(f,{name:"comment",class:"q-mr-sm"}),t[35]||(t[35]=c(" Agregar Observación ",-1))])])]),body:i(()=>[o(Q,{onSubmit:P(G,["prevent"])},{default:i(()=>[e("div",zt,[t[36]||(t[36]=e("p",{class:"text-body1 q-mb-md"}," Agrega una observación o solicitud de corrección al aprendiz. ",-1)),o(j,{modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=a=>n.value=a),filled:"",type:"textarea",label:"Observación *",rows:"4",rules:[a=>!!a?.trim()||"La observación es requerida"],hint:"El aprendiz recibirá esta observación y podrá corregir su solicitud"},null,8,["modelValue","rules"])])]),_:1})]),footer:i(()=>[e("div",Pt,[o(b,{label:"Cancelar","custom-class":"boton-cerrar",onClick:F}),o(b,{label:"Enviar","custom-class":"gradient-btn",loading:s(u),onClick:G},null,8,["loading"])])]),_:1},8,["modelValue"])])])]),_:1}))}},da=ue(jt,[["__scopeId","data-v-1ac9cf41"]]);export{da as default};
